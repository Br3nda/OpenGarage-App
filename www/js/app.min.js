angular.module("opengarage",["ionic","opengarage.controllers","opengarage.utils"]).run(function($state,$ionicPlatform,$ionicScrollDelegate,$ionicHistory,$location,$document,$window,$rootScope,$ionicLoading,$ionicPopup,$timeout,Utils){$ionicPlatform.ready(function(){$rootScope.open=window.open,window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar&&window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&(window.StatusBar.styleLightContent(),window.StatusBar.backgroundColorByHexString("#444"),angular.element($window).on("statusTap",function(){$ionicScrollDelegate.scrollTop()}),window.Intercom&&(window.Intercom("onShow",function(){window.StatusBar.hide()}),window.Intercom("onHide",function(){window.StatusBar.show()}))),$timeout(function(){try{navigator.splashscreen.hide()}catch(err){}},500)}),$rootScope.version=window.appVersion,$rootScope.networkStatus=$window.navigator.onLine?"up":"down",$rootScope.loadingCount=0,$rootScope.controllers=[],$rootScope.$on("loading:show",function(e,data){$rootScope.loadingCount++,$rootScope.canceller=data.canceller.resolve,$ionicLoading.show({template:"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='$root.canceller()'>Cancel</button>"})}),$rootScope.$on("loading:hide",function(){$rootScope.loadingCount--,$rootScope.loadingCount<=0&&($rootScope.loadingCount=0,$ionicLoading.hide())}),$rootScope.$on("$ionicView.afterEnter",function(){$document[0].title="OpenGarage"}),angular.element($window).on("online",Utils.networkUp).on("offline",Utils.networkDown);var firstLoadHandler=$rootScope.$on("$stateChangeStart",function(event){firstLoadHandler(),event.preventDefault(),Utils.storage.get(["activeController","controllers"],function(data){try{data.controllers=JSON.parse(data.controllers),data.activeController=JSON.parse(data.activeController)}catch(err){}data.activeController&&"object"==typeof data.activeController?(Utils.setController(data.activeController),$state.go("app.home")):$state.go("app.controllerSelect")})});angular.element(window).on("resize",function(){$rootScope.$broadcast("window:resize"),window.innerWidth>768&&angular.element("#mainContent").width(window.innerWidth-275)})}).config(function($stateProvider,$urlRouterProvider,$httpProvider,$compileProvider,$ionicConfigProvider){/MSIE\s|Trident\/|Edge\//.test(window.navigator.userAgent)&&$ionicConfigProvider.platform["default"].spinner.icon("android"),$ionicConfigProvider.backButton.previousTitleText(!1).text("Back"),/Firefox/.test(navigator.userAgent)&&$ionicConfigProvider.scrolling.jsScrolling(!1),$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|app|local|file):/),$compileProvider.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|content|blob|ms-appx|x-wmapp0|chrome-extension|app|local):|data:image\//),$stateProvider.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"MenuCtrl"}).state("app.home",{url:"/home",views:{menuContent:{templateUrl:"templates/home.html",controller:"HomeCtrl"}},resolve:{checkValid:function($timeout,$q,$state,$rootScope,$filter,Utils){var total=$rootScope.controllers.length,filterFilter=$filter("filter"),invalidOrg=!(!$rootScope.activeController||0!==filterFilter($rootScope.controllers,{mac:$rootScope.activeController.mac}).length);return $rootScope.activeController||1!==total?!$rootScope.activeController||invalidOrg?(delete $rootScope.activeController,Utils.storage.remove("activeController"),$timeout(function(){$state.go("app.controllerSelect")}),$q.reject()):void 0:void Utils.setController($rootScope.controllers[0])}}}).state("app.controllerSelect",{url:"/controllerSelect",views:{menuContent:{templateUrl:"templates/controllerSelect.html",controller:"ControllerSelectCtrl"}}}).state("app.settings",{url:"/settings",views:{menuContent:{templateUrl:"templates/settings.html",controller:"SettingsCtrl"}},resolve:{checkValid:function($rootScope,$q){if(!$rootScope.activeController)return $q.reject()}}}).state("app.help",{url:"/help",views:{menuContent:{templateUrl:"templates/help.html",controller:"HelpCtrl"}}}).state("otherwise",{url:"*path",template:"",controller:function($state,$rootScope){$rootScope.activeController?$state.go("app.home"):$state.go("app.controllerSelect")}}),$httpProvider.interceptors.push(function($rootScope,$q,$injector,Utils){return{request:function(config){if($rootScope.activeController&&config.url.indexOf($rootScope.activeController.ip)!==-1&&!config.suppressLoader){var canceller=$q.defer();config.timeout=canceller.promise,"number"!=typeof config.retryCount&&(config.retryCount=0),$rootScope.$broadcast("loading:show",{canceller:canceller})}return config},response:function(response){return $rootScope.activeController&&response.config.url.indexOf($rootScope.activeController.ip)!==-1&&(response.config.suppressLoader||$rootScope.$broadcast("loading:hide"),Utils.networkUp()),response},responseError:function(error){var isAPI=!(!$rootScope.activeController||error.config.url.indexOf($rootScope.activeController.ip)===-1);if(error.config.timeout&&error.config.timeout.$$state&&1===error.config.timeout.$$state.status&&(error.canceled=!0),isAPI&&(error.config.suppressLoader||$rootScope.$broadcast("loading:hide"),error.status>0&&Utils.networkUp(),401===error.status))return Utils.logout(),$q.reject(error);if(error.status<=0&&!error.canceled){if(error.config.retryCount<3){var $http=$injector.get("$http");return error.config.retryCount++,$http(error.config)}return error.retryFailed=!0,error.canceled=!0,isAPI&&Utils.networkDown(),$q.reject(error)}return $q.reject(error)}}}),$ionicConfigProvider.views.forwardCache(!0)}),angular.module("opengarage.controllers",["opengarage.utils"]).controller("ControllerSelectCtrl",function($scope,$state,$rootScope,$filter,$ionicHistory,Utils){var orderFilter=$filter("orderBy");$scope.data={},$scope.updateView=function(){$scope.filtered=orderFilter($rootScope.controllers,"Name")},$scope.setController=function(controller){Utils.setController(controller),$ionicHistory.nextViewOptions({historyRoot:!0}),$rootScope.$broadcast("updateData",{controllerChange:!0}),$state.go("app.home")},$rootScope.$on("updateData",function(){$scope.updateView(),"app.controllerSelect"===$ionicHistory.currentView().stateId&&$state.go("app.home")}),$scope.$on("$ionicView.beforeEnter",function(){$rootScope.activeController?$scope.data.pageTitle="Switch Controller":$scope.data.pageTitle="Select Controller",$scope.updateView()})}).controller("SettingsCtrl",function(){}).controller("HelpCtrl",function(){}).controller("MenuCtrl",function($scope,$ionicSideMenuDelegate,Utils){$scope.showAddController=Utils.showAddController,$scope.closeMenu=function(){$ionicSideMenuDelegate.toggleLeft(!1)}}).controller("HomeCtrl",function(){}),angular.module("opengarage.utils",[]).factory("Utils",["$injector","$rootScope",function($injector,$rootScope){var $ionicPopup,isFireFox=/Firefox/.test(window.navigator.userAgent),isIE=/MSIE\s|Trident\/|Edge\//.test(window.navigator.userAgent),storage={get:function(query,callback){callback=callback||function(){};var i,data={};"string"==typeof query&&(query=[query]);for(i in query)query.hasOwnProperty(i)&&(data[query[i]]=localStorage.getItem(query[i]));callback(data)},set:function(query,callback){callback=callback||function(){};var i;if("object"==typeof query)for(i in query)query.hasOwnProperty(i)&&localStorage.setItem(i,query[i]);callback(!0)},remove:function(query,callback){callback=callback||function(){};var i;"string"==typeof query&&(query=[query]);for(i in query)query.hasOwnProperty(i)&&localStorage.removeItem(query[i]);callback(!0)}},setController=function(){};return isFireFox&&(HTMLElement.prototype.click=function(){var evt=this.ownerDocument.createEvent("MouseEvents");evt.initMouseEvent("click",!0,!0,this.ownerDocument.defaultView,1,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(evt)}),{isIE:isIE,storage:storage,setController:setController,networkDown:function(){"down"!==$rootScope.networkStatus&&($rootScope.networkStatus="down",$rootScope.$broadcast("networkDown"))},networkUp:function(){"up"!==$rootScope.networkStatus&&($rootScope.networkStatus="up",$rootScope.$broadcast("networkUp"))},showAddController:function(callback){callback=callback||function(){},$ionicPopup=$ionicPopup||$injector.get("$ionicPopup");var scope=$rootScope.$new();scope.data={},$ionicPopup.show({templateUrl:"templates/addController.html",title:"Add Controller",scope:scope,buttons:[{text:"Cancel"},{text:"<b>Add</b>",type:"button-positive",onTap:function(e){return scope.data.ip&&scope.data.password?void(scope.data.name||(scope.data.name="Controller "+($rootScope.controllers.length+1))):void e.preventDefault()}}]}).then(function(){addController(scope.data,callback)})},addController:function(data,callback){}}}]);
//# sourceMappingURL=app.min.js.map
