{"version":3,"sources":["app.min.js"],"names":["angular","module","run","$state","$ionicPlatform","$ionicScrollDelegate","$ionicHistory","$location","$document","$window","$rootScope","$ionicLoading","$ionicPopup","$timeout","Utils","Cloud","ready","open","url","window","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleLightContent","backgroundColorByHexString","element","on","scrollTop","navigator","splashscreen","hide","err","connected","version","appVersion","loadingCount","controllers","$on","e","data","canceller","resolve","noop","show","template","title","checkNewController","sync","firstLoadHandler","event","preventDefault","storage","get","JSON","parse","activeController","go","updateController","$broadcast","innerWidth","document","getElementById","width","config","$stateProvider","$urlRouterProvider","$httpProvider","$compileProvider","$ionicConfigProvider","test","userAgent","platform","default","spinner","icon","backButton","previousTitleText","text","scrolling","jsScrolling","aHrefSanitizationWhitelist","imgSrcSanitizationWhitelist","state","abstract","templateUrl","controller","views","menuContent","checkValid","$q","$filter","total","length","filterFilter","invalidOrg","mac","remove","reject","set","stringify","interceptors","push","$injector","request","suppressLoader","defer","timeout","promise","retryCount","response","responseError","error","$$state","status","canceled","$http","retryFailed","forwardCache","filter","items","filterOn","isUndefined","isArray","newItems","extractValueToCompare","item","isObject","isString","forEach","isDuplicate","i","equals","factory","$httpParamSerializerJQLike","$ionicActionSheet","requestAuth","scope","$new","buttons","type","onTap","username","password","then","isValid","login","syncStart","user","pass","callback","method","headers","Content-Type","action","result","token","cloudToken","cloudDataToken","sjcl","codec","hex","fromBits","hash","sha256","loggedin","logout","isSynced","getSites","sites","Object","keys","finish","saveSites","titleText","cancelText","buttonClicked","index","concat","local","undefined","handleInvalidDataToken","controllerType","success","message","handleExpiredLogin","decrypt","encodeURIComponent","encrypt","prompt","subTitle","inputType","inputPlaceholder","confirm","getTokenUser","atob","split","$scope","$ionicModal","showDelete","image","cropped","fileInput","fromTemplateUrl","modal","crop","hasCamera","camera","getPicture","setController","nextViewOptions","historyRoot","deleteController","indexOf","splice","moveItem","fromIndex","toIndex","getTime","timestamp","Date","toLocaleString","selectPhoto","$event","stopPropagation","$apply","parent","reset","one","file","files","match","reader","FileReader","onload","evt","target","readAsDataURL","click","uploadPhoto","changeSync","getLogs","reply","isLocal","logs","settings","changePassword","restart","restartController","submit","saveOptions","alert","getControllerOptions","mod","fwv","$ionicSideMenuDelegate","showAddController","showAddBlynk","closeMenu","toggleLeft","interval","toggleDoor","clearInterval","setInterval","isFireFox","isIE","query","hasOwnProperty","localStorage","getItem","setItem","removeItem","intToIP","int","getControllerSettings","ip","auth","name","door","parseInt","pins","pin","value","dist","rcnt","lastUpdate","showLoader","copy","save","extend","when","addController","pop","join","ssids","connectNewController","animation","ssid","setTimeout","saveNewController","scanLocalNetwork","networkinterface","getIPAddress","router","baseip","check","matches","catch","queue","all","requestPassword","HTMLElement","prototype","this","ownerDocument","createEvent","initMouseEvent","defaultView","dispatchEvent","canScan","scan","foundControllers","popup","close","params","paramSerializer","pwd","nkey","ckey","sort","a","b"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\n\n// OpenGarage\n// Controllers are found in controllers.js and utilities are located in utils.js\nangular.module( \"opengarage\", [ \"ionic\", \"uiCropper\", \"opengarage.controllers\", \"opengarage.utils\", \"opengarage.cloud\" ] )\n\t.run( function( $state, $ionicPlatform, $ionicScrollDelegate, $ionicHistory, $location, $document, $window, $rootScope, $ionicLoading, $ionicPopup, $timeout, Utils, Cloud ) {\n\n\t\t// Ready function fires when the DOM is ready and after deviceready event is fired if Cordova is being used\n\t\t$ionicPlatform.ready( function() {\n\n\t\t\t// Map inAppBrowser to rootScope\n\t\t\t$rootScope.open = function( url ) {\n\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t};\n\n\t\t\t// Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n\t\t\t// for form inputs)\n\t\t\tif ( window.cordova && window.cordova.plugins && window.cordova.plugins.Keyboard && window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar ) {\n\t\t\t\twindow.cordova.plugins.Keyboard.hideKeyboardAccessoryBar( true );\n\t\t\t}\n\t\t\tif ( window.StatusBar ) {\n\n\t\t\t\t// Use white text/icons on the status bar\n\t\t        window.StatusBar.styleLightContent();\n\n\t\t        //Change the status bar color to match the header\n                window.StatusBar.backgroundColorByHexString( \"#444\" );\n\n\t\t        // Scroll to the top of the page when the status bar is tapped\n\t\t\t\tangular.element( $window ).on( \"statusTap\", function() {\n\t\t\t\t\t$ionicScrollDelegate.scrollTop();\n\t\t        } );\n\t\t\t}\n\n\t\t    // Hide the splash screen after 500ms of the app being ready\n\t\t    $timeout( function() {\n\t\t        try {\n\t\t            navigator.splashscreen.hide();\n\t\t        } catch ( err ) {}\n\t\t    }, 500 );\n\t\t} );\n\n\t\t// Define connected state of current controller\n\t\t$rootScope.connected = false;\n\n\t\t// Define version, build number and debug state\n\t\t$rootScope.version = window.appVersion;\n\n\t    // Define total loading requests\n\t    $rootScope.loadingCount = 0;\n\n\t    // Initialize controllers array\n\t    $rootScope.controllers = [];\n\n\t\t// Automatically show a loading message on any AJAX request\n\t\t$rootScope.$on( \"loading:show\", function( e, data ) {\n\n\t\t\t$rootScope.loadingCount++;\n\t\t\t$rootScope.canceller = data ? data.canceller.resolve : angular.noop;\n\t\t\t$ionicLoading.show( {\n\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='$root.canceller()'>Cancel</button>\"\n\t\t\t} );\n\t\t} );\n\n\t\t// Automatically hide the loading message after an AJAX request\n\t\t$rootScope.$on( \"loading:hide\", function() {\n\n\t\t\t$rootScope.loadingCount--;\n\t\t\tif ( $rootScope.loadingCount <= 0 ) {\n\t\t\t\t$rootScope.loadingCount = 0;\n\t\t\t\t$ionicLoading.hide();\n\t\t\t}\n\t\t} );\n\n\t\t// Keep the page title locked as the app name\n\t\t$rootScope.$on( \"$ionicView.afterEnter\", function() {\n\t\t\t$document[ 0 ].title = \"OpenGarage\";\n\t\t} );\n\n\t\tangular.element( $document ).on( \"resume\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\tUtils.checkNewController();\n\t\t\t\tCloud.sync();\n\t\t\t}, 100 );\n\t\t} );\n\n\t\t// Handle loading of the first page\n\t\tvar firstLoadHandler = $rootScope.$on( \"$stateChangeStart\", function( event ) {\n\n\t\t\t// Unbind event handler so this check is only performed on the first app load\n\t\t    firstLoadHandler();\n\n\t\t    // Prevent any page change from occurring\n\t        event.preventDefault();\n\n\t\t    Utils.storage.get( [ \"activeController\", \"controllers\" ], function( data ) {\n\n\t\t\t\ttry {\n\t\t\t\t\t$rootScope.controllers = JSON.parse( data.controllers );\n\t\t\t\t\t$rootScope.activeController = JSON.parse( data.activeController );\n\t\t\t\t} catch ( err ) {}\n\n\t\t\t\tif ( !$rootScope.controllers ) {\n\t\t\t\t\t$rootScope.controllers = [];\n\t\t\t\t}\n\n\t\t\t\tCloud.sync();\n\n\t\t\t\t// Restore the active controller, if available\n\t\t        if ( $rootScope.activeController && typeof $rootScope.activeController === \"object\" ) {\n\n\t\t\t\t\t// If a user object is cached, proceed to load the app while updating user object in the background\n\t\t\t\t\t$state.go( \"app.home\" );\n\n\t\t\t\t\tUtils.updateController();\n\t\t        } else {\n\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t        }\n\t\t    } );\n\n\t\t    Utils.checkNewController();\n\t\t} );\n\n\t\t// Resize the main content view to fit when the window changes size\n\t\tangular.element( window ).on( \"resize\", function() {\n\t\t\t$rootScope.$broadcast( \"window:resize\" );\n\t\t\tif ( window.innerWidth > 768 ) {\n\t\t\t\tdocument.getElementById( \"mainContent\" ).width = window.innerWidth - 275;\n\t\t\t}\n\t\t} );\n\t} )\n\n\t.config( function( $stateProvider, $urlRouterProvider, $httpProvider, $compileProvider, $ionicConfigProvider ) {\n\n\t\tif ( /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ) ) {\n\n\t\t\t// Change the default spinner for IE to android which has JS based animation\n\t\t\t$ionicConfigProvider.platform.default.spinner.icon( \"android\" );\n\t\t}\n\n\t\t// Change the back text to always say 'Back'\n\t\t$ionicConfigProvider.backButton.previousTitleText( false ).text( \"Back\" );\n\n\t\t// Use native scrolling for FireFox\n\t\tif ( /Firefox/.test( navigator.userAgent ) ) {\n\t\t\t$ionicConfigProvider.scrolling.jsScrolling( false );\n\t\t}\n\n\t\t// Modify Ionic's allowed href protocols to allow Firefox, Blackberry, iOS and Chrome support\n\t\t$compileProvider.aHrefSanitizationWhitelist( /^\\s*(https?|ftp|mailto|chrome-extension|app|local|file):/ );\n\n\t\t// Modify Ionic's allowed image source protocols\n\t\t$compileProvider.imgSrcSanitizationWhitelist( /^\\s*(https?|ftp|file|content|blob|ms-appx|x-wmapp0|chrome-extension|app|local):|data:image\\// );\n\n\t\t// Define all available routes and their associated controllers\n\t\t$stateProvider\n\n\t\t\t// Used as the parent route after authentication is complete allowing the same header\n\t\t\t// and side menu's to be used throughout all child views\n\t\t\t.state( \"app\", {\n\t\t\t\turl: \"/app\",\n\t\t\t\tabstract: true,\n\t\t\t\ttemplateUrl: \"templates/menu.html\",\n\t\t\t\tcontroller: \"MenuCtrl\"\n\t\t\t} )\n\n\t\t\t.state( \"app.home\", {\n\t\t\t\turl: \"/home\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/home.html\",\n\t\t\t\t\t\tcontroller: \"HomeCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $timeout, $q, $state, $rootScope, $filter, Utils ) {\n\t\t\t\t\t\tvar total = $rootScope.controllers.length,\n\t\t\t\t\t\t\tfilterFilter = $filter( \"filter\" ),\n\t\t\t\t\t\t\tinvalidOrg = ( $rootScope.activeController && filterFilter( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ).length === 0 ) ? true : false;\n\n\t\t\t\t\t\tif ( !$rootScope.activeController && total === 1 ) {\n\t\t\t\t\t\t\t$rootScope.activeController = $rootScope.controllers[ 0 ];\n\t\t\t\t\t\t\tUtils.updateController();\n\t\t\t\t\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !$rootScope.activeController || invalidOrg ) {\n\n\t\t\t\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\t\t\t\tUtils.storage.remove( \"activeController\" );\n\n\t\t\t\t\t\t\t// If the active controller is not found in the controller list, show the select controller screen\n\t\t\t\t\t\t\t$timeout( function() {\n\t\t\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.controllerSelect\", {\n\t\t\t\turl: \"/controllerSelect\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/controllerSelect.html\",\n\t\t\t\t\t\tcontroller: \"ControllerSelectCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.history\", {\n\t\t\t\turl: \"/history\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/history.html\",\n\t\t\t\t\t\tcontroller: \"HistoryCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.settings\", {\n\t\t\t\turl: \"/settings\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/settings.html\",\n\t\t\t\t\t\tcontroller: \"SettingsCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.help\", {\n\t\t\t\turl: \"/help\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/help.html\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t// Defines the otherwise route which will redirect any invalid URL back to the start page\n\t\t\t.state( \"otherwise\", {\n\t\t\t\turl: \"*path\",\n\t\t\t\ttemplate: \"\",\n\t\t\t\tcontroller: function( $state, $rootScope ) {\n\n\t\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Add an HTTP interceptor\n\t\t$httpProvider.interceptors.push( function( $rootScope, $q, $injector ) {\n\t\t\treturn {\n\t\t\t\trequest: function( config ) {\n\n\t\t\t\t\t// When an AJAX request to the controller is started, fire an event to show a loading message\n\t\t\t\t\tif ( !config.suppressLoader ) {\n\n\t\t\t\t\t\t// Change timeout to a promise we can cancel\n\t\t\t\t\t\tvar canceller = $q.defer();\n\n\t\t\t\t\t\t// Set the timeout to the canceller promise\n\t\t\t\t\t\tconfig.timeout = canceller.promise;\n\n\t\t\t\t\t\t// Set the current retry count to 0\n\t\t\t\t\t\tif ( typeof config.retryCount !== \"number\" ) {\n\t\t\t\t\t\t\tconfig.retryCount = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\", { canceller: canceller } );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn config;\n\t\t\t\t},\n\t\t\t\tresponse: function( response ) {\n\n\t\t\t\t\t// If the request is to the controller, broadcast a hide loading message\n\t\t\t\t\tif ( !response.config.suppressLoader ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t\tresponseError: function( error ) {\n\n\t\t\t\t\t// If the timeout value is an object and is resolved, mark request as user canceled\n\t\t\t\t\tif ( error.config.timeout && error.config.timeout.$$state && error.config.timeout.$$state.status === 1 ) {\n\t\t\t\t\t\terror.canceled = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !error.config.suppressLoader ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the request timed out and is not user canceled, retry the request up to three times\n\t\t\t\t\tif ( error.status <= 0 && !error.canceled ) {\n\t\t\t\t\t\tif ( error.config.retryCount < 3 ) {\n\t\t\t\t\t\t\tvar $http = $injector.get( \"$http\" );\n\n\t\t\t\t\t\t\terror.config.retryCount++;\n\n\t\t\t\t\t\t\t// Return the new promise object\n\t\t\t\t\t\t\treturn $http( error.config );\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// After three timeouts, assume the network is down\n\t\t\t\t\t\t\terror.retryFailed = true;\n\t\t\t\t\t\t\terror.canceled = true;\n\n\t\t\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t}\n\t\t\t};\n\t\t} );\n\n\t\t// Inform Ionic we want to cache forward views\n\t\t$ionicConfigProvider.views.forwardCache( true );\n\t} )\n\t.filter( \"unique\", function() {\n\t\treturn function( items, filterOn ) {\n\t\t\tif ( filterOn === false ) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif ( ( filterOn || angular.isUndefined( filterOn ) ) && angular.isArray( items ) ) {\n\t\t\t\tvar newItems = [],\n\t\t\t\t\textractValueToCompare = function( item ) {\n\t\t\t\t\t\tif ( angular.isObject( item ) && angular.isString( filterOn ) ) {\n\t\t\t\t\t\t\treturn item[ filterOn ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tangular.forEach( items, function( item ) {\n\t\t\t\t\tvar isDuplicate = false;\n\n\t\t\t\t\tfor ( var i = 0; i < newItems.length; i++ ) {\n\t\t\t\t\t\tif ( angular.equals( extractValueToCompare( newItems[ i ] ), extractValueToCompare( item ) ) ) {\n\t\t\t\t\t\t\tisDuplicate = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( !isDuplicate ) {\n\t\t\t\t\t\tnewItems.push( item );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\titems = newItems;\n\t\t\t}\n\t\treturn items;\n\t\t};\n\t} );\n\n/* global angular, sjcl */\n\n// OpenGarage\nangular.module( \"opengarage.cloud\", [ \"opengarage.utils\" ] )\n    .factory( \"Cloud\", [ \"$injector\", \"$rootScope\", \"Utils\", function( $injector, $rootScope, Utils ) {\n\n        var requestAuth = function() {\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n                var scope = $rootScope.$new();\n                scope.data = {};\n\n                $ionicPopup.show( {\n                    templateUrl: \"templates/cloudLogin.html\",\n                    title: \"OpenGarage.io Login\",\n                    scope: scope,\n                    buttons: [\n                        { text: \"Cancel\" },\n                        {\n                            text: \"<b>Login</b>\",\n                            type: \"button-positive\",\n                            onTap: function( e ) {\n                                if ( !scope.data.username || !scope.data.password ) {\n                                    e.preventDefault();\n                                    return;\n                                }\n\n                                return true;\n                            }\n                        }\n                    ]\n                } ).then( function( isValid ) {\n                    if ( isValid ) {\n                        login( scope.data.username, scope.data.password, syncStart );\n                    }\n                } );\n            },\n            login = function( user, pass, callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                $http( {\n                    method: \"POST\",\n                    url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t},\n                    data: $httpParamSerializerJQLike( {\n                        action: \"ajaxLogin\",\n                        username: user,\n                        password: pass\n                    } )\n                } ).then( function( result ) {\n                    if ( typeof result.data.token === \"string\" ) {\n                        Utils.storage.set( {\n                            \"cloudToken\": result.data.token,\n                            \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( pass ) )\n                        } );\n                    }\n                    callback( result.data.loggedin );\n                }, function() {\n                    callback( false );\n                } );\n            },\n            logout = function() {\n                Utils.storage.remove( \"cloudToken\" );\n                $rootScope.isSynced = false;\n            },\n            syncStart = function() {\n                $ionicActionSheet = $ionicActionSheet || $injector.get( \"$ionicActionSheet\" );\n\n                getSites( function( sites ) {\n                    if ( JSON.stringify( sites ) === JSON.stringify( $rootScope.controllers ) ) {\n                        return;\n                    }\n\n                    if ( Object.keys( sites ).length > 0 ) {\n\n                        var finish = function() {\n\t\t\t\t\t\t\t$rootScope.controllers = sites;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( sites ) }, saveSites );\n                        };\n\n                        // Handle how to merge when cloud is populated\n                        $ionicActionSheet.show( {\n                            buttons: [\n                                { text: \"Merge\" },\n                                { text: \"Replace local with cloud\" },\n                                { text: \"Replace cloud with local\" }\n                            ],\n                            titleText: \"Select Merge Method\",\n                            cancelText: \"Cancel\",\n                            buttonClicked: function( index ) {\n                                if ( index === 1 ) {\n\n                                    // Replace local with cloud\n                                    finish();\n                                } else if ( index === 2 ) {\n\n                                    // Replace cloud with local\n                                    sites = $rootScope.controllers;\n                                    finish();\n                                } else {\n\t\t\t\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n                                    // Merge data\n                                    sites = $filter( \"unique\" )( $rootScope.controllers.concat( sites ), \"mac\" );\n                                    finish();\n                                }\n                                return true;\n                            }\n                        } );\n                    } else {\n                        saveSites();\n                    }\n                } );\n            },\n            sync = function( callback ) {\n                callback = callback || function() {};\n\n                Utils.storage.get( \"cloudToken\", function( local ) {\n                    if ( typeof local.cloudToken !== \"string\" ) {\n                        return;\n                    }\n\n                    getSites( function( data ) {\n                        if ( data !== false ) {\n                            $rootScope.controllers = data;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( data ) }, callback );\n                        }\n                    } );\n                } );\n            },\n            getSites = function( callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( local ) {\n                    if ( local.cloudToken === undefined || local.cloudToken === null ) {\n                        callback( false );\n                        return;\n                    }\n\n                    if ( local.cloudDataToken === undefined || local.cloudDataToken === null ) {\n                        handleInvalidDataToken();\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        data: $httpParamSerializerJQLike( {\n                            action: \"getSites\",\n                            token: local.cloudToken,\n                            controllerType: \"opengarage\"\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false || result.data.sites === \"\" ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\":result.data.token } );\n                            var sites;\n\n                            try {\n                                sites = sjcl.decrypt( local.cloudDataToken, result.data.sites );\n                            } catch ( err ) {\n                                if ( err.message === \"ccm: tag doesn't match\" ) {\n                                    handleInvalidDataToken();\n                                }\n                                callback( false );\n                            }\n\n                            try {\n                                callback( JSON.parse( sites ) );\n                            } catch ( err ) {\n                                callback( false );\n                            }\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            saveSites = function( callback ) {\n\t\t\t\tif ( typeof callback !== \"function\" ) {\n\t                callback = function() {};\n\t\t\t\t}\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n                    if ( data.cloudToken === null || data.cloudToken === undefined ) {\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        data: $httpParamSerializerJQLike( {\n                            action: \"saveSites\",\n                            token: data.cloudToken,\n                            controllerType: \"opengarage\",\n                            sites: encodeURIComponent( JSON.stringify( sjcl.encrypt( data.cloudDataToken, JSON.stringify( $rootScope.controllers ) ) ) )\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\":result.data.token } );\n                            callback( result.data.success );\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            handleInvalidDataToken = function() {\n                Utils.storage.remove( \"cloudDataToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.prompt( {\n                    title: \"Unable to read cloud data\",\n                    subTitle: \"Enter a valid password to decrypt the data\",\n                    template: \"Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.\",\n                    inputType: \"password\",\n                    inputPlaceholder: \"Password\"\n                } ).then( function( password ) {\n                    Utils.storage.set( {\n                        \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( password ) )\n                    } );\n                    sync();\n                } );\n            },\n            handleExpiredLogin = function() {\n                Utils.storage.remove( \"cloudToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.confirm( {\n                    title: \"OpenGarage.io Login Expired\",\n                    template: \"Click here to re-login to OpenGarage.io\"\n                } ).then( function( result ) {\n                    if ( result ) {\n\n                        requestAuth( function( result ) {\n                            if ( result === true ) {\n                                sync();\n                            }\n                        } );\n\n                    }\n                } );\n            },\n            getTokenUser = function( token ) {\n                return atob( token ).split( \"|\" )[ 0 ];\n            },\n            $http, $httpParamSerializerJQLike, $filter, $ionicPopup, $ionicActionSheet;\n\n        Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n\t\t\tif ( data.cloudToken === null || data.cloudToken === undefined || data.cloudDataToken === undefined || data.cloudDataToken === undefined ) {\n\t\t\t\t$rootScope.isSynced = false;\n\t\t\t} else {\n\t\t\t\t$rootScope.isSynced = true;\n\t\t\t}\n        } );\n\n        $rootScope.$on( \"triggerCloudSave\", saveSites );\n\n        return {\n            requestAuth: requestAuth,\n            login: login,\n            logout: logout,\n            syncStart: syncStart,\n            sync: sync,\n            getSites: getSites,\n            saveSites: saveSites,\n            handleInvalidDataToken: handleInvalidDataToken,\n            handleExpiredLogin: handleExpiredLogin,\n            getTokenUser: getTokenUser\n        };\n    } ] );\n\n/* global angular */\n\nangular.module( \"opengarage.controllers\", [ \"opengarage.utils\", \"opengarage.cloud\" ] )\n\n\t.controller( \"ControllerSelectCtrl\", function( $scope, $state, $rootScope, $timeout, $filter, $ionicModal, $ionicHistory, Utils, Cloud ) {\n\t\t$scope.data = {\n\t\t\tshowDelete: false,\n\t\t\timage: false,\n\t\t\tcropped: false,\n\t\t\tindex: false\n\t\t};\n\n\t\tvar fileInput = angular.element( document.getElementById( \"photoUpload\" ) );\n\n\t\t$ionicModal.fromTemplateUrl( \"templates/crop.html\", {\n\t\t\tscope: $scope\n\t\t} ).then( function( modal ) {\n\t\t\t$scope.crop = modal;\n\t\t} );\n\n\t\t$scope.hasCamera = navigator.camera && navigator.camera.getPicture ? true : false;\n\n\t\t$scope.setController = function( index ) {\n\t\t\t$rootScope.activeController = $rootScope.controllers[ index ];\n\t\t\t$rootScope.connected = false;\n\t\t\tUtils.updateController();\n\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\n\t\t\t$ionicHistory.nextViewOptions( {\n\t\t\t\thistoryRoot: true\n\t\t\t} );\n\n\t\t\t$state.go( \"app.home\" );\n\t\t};\n\n\t\t$scope.deleteController = function( index ) {\n\t\t\tif ( $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] ) === index ) {\n\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\tUtils.storage.remove( \"activeController\" );\n\t\t\t}\n\n\t\t\t$rootScope.controllers.splice( index, 1 );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\tCloud.saveSites();\n\t\t};\n\n\t\t$scope.moveItem = function( item, fromIndex, toIndex ) {\n\t\t\t$rootScope.controllers.splice( fromIndex, 1 );\n\t\t\t$rootScope.controllers.splice( toIndex, 0, item );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\tCloud.saveSites();\n\t\t};\n\n\t\t$scope.getTime = function( timestamp ) {\n\t\t\treturn new Date( timestamp ).toLocaleString();\n\t\t};\n\n\t\t$scope.selectPhoto = function( $event, index ) {\n\t\t\t$event.stopPropagation();\n\n\t\t\tif ( $scope.data.showDelete ) {\n\t\t\t\tif ( $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] ) === index ) {\n\t\t\t\t\tdelete $rootScope.activeController.image;\n\t\t\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t}\n\n\t\t\t\tdelete $rootScope.controllers[ index ].image;\n\t\t        Utils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\tCloud.saveSites();\n\t\t        $timeout( function() {\n\t\t\t\t\t$scope.$apply();\n\t\t        } );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfileInput.parent()[ 0 ].reset();\n\n\t\t\tfileInput.one( \"change\", function() {\n\t\t\t\tvar file = fileInput[ 0 ].files[ 0 ];\n\n\t\t\t\tif ( !file.type || !file.type.match( \"image.*\" ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\treader.onload = function( evt ) {\n\t\t\t\t\t$scope.data.image = evt.target.result;\n\t\t\t\t\t$scope.data.index = index;\n\t\t\t\t\t$scope.crop.show();\n\t\t\t\t};\n\t\t\t\treader.readAsDataURL( file );\n\t\t\t} );\n\n\t\t\tfileInput[ 0 ].click();\n\t\t};\n\n\t\t$scope.uploadPhoto = function( index ) {\n\t\t\t$scope.crop.hide();\n\n\t\t\tif ( $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] ) === index ) {\n\t\t\t\t$rootScope.activeController.image = $scope.data.cropped;\n\t\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t}\n\n\t\t\t$rootScope.controllers[ index ].image = $scope.data.cropped;\n\t        Utils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\tCloud.saveSites();\n\t        $timeout( function() {\n\t\t\t\t$scope.$apply();\n\t        } );\n\t\t};\n\n\t\t$scope.changeSync = function() {\n\t\t\tif ( $rootScope.isSynced ) {\n\t\t\t\tCloud.logout();\n\t\t\t} else {\n\t\t\t\tCloud.requestAuth();\n\t\t\t}\n\t\t};\n\t} )\n\n\t.controller( \"HistoryCtrl\", function( $scope, Utils ) {\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getLogs( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\t$scope.isLocal = true;\n\t\t\t\t\t$scope.logs = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"SettingsCtrl\", function( $scope, $state, $ionicPopup, Utils ) {\n\t\t$scope.settings = {};\n\n\t\t$scope.changePassword = Utils.changePassword;\n\t\t$scope.restart = Utils.restartController;\n\n\t\t$scope.submit = function() {\n\t\t\tUtils.saveOptions( $scope.settings, function( reply ) {\n\t\t\t\tvar text;\n\n\t\t\t\tif ( reply ) {\n\t\t\t\t\ttext = \"Settings saved successfully!\";\n\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t} else {\n\t\t\t\t\ttext = \"Unable to save settings. Please check the connection to the device and try again.\";\n\t\t\t\t}\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>\" + text + \"</p>\"\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getControllerOptions( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\t\t// Remove unused options to prevent accidental change\n\t\t\t\t\tdelete reply.mod;\n\t\t\t\t\tdelete reply.fwv;\n\t\t\t\t\t$scope.settings = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t}, null, true );\n\t\t} );\n\t} )\n\n\t.controller( \"MenuCtrl\", function( $scope, $rootScope, $ionicActionSheet, $ionicPopup, $ionicSideMenuDelegate, Utils ) {\n\n\t\t$scope.showAddController = function() {\n\t\t\t$ionicActionSheet.show( {\n\t\t\t\tbuttons: [\n\t\t\t\t\t{ text: \"Add by IP\" },\n\t\t\t\t\t{ text: \"Add by Blynk Token\" },\n\t\t\t\t\t{ text: \"Setup New Device\" }\n\t\t\t\t],\n\t\t\t\ttitleText: \"Add Controller\",\n\t\t\t\tcancelText: \"Cancel\",\n\t\t\t\tbuttonClicked: function( index ) {\n\t\t\t\t\tif ( index === 1 ) {\n\t\t\t\t\t\tUtils.showAddBlynk();\n\t\t\t\t\t} else if ( index === 0 ) {\n\t\t\t\t\t\tUtils.showAddController();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\t\t\t\t\t\tUtils.checkNewController( function( result ) {\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Please first connect the power to your OpenGarage. Once complete, connect this device to the wifi network broadcast by the OpenGarage (named OG_XXXXXX) and reopen this app.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\t// Function to close the menu which is fired after a side menu link is clicked.\n\t\t// This is done instead of using the menu-close directive to preserve the root history stack\n\t    $scope.closeMenu = function() {\n            $ionicSideMenuDelegate.toggleLeft( false );\n\t    };\n\t} )\n\n\t.controller( \"HomeCtrl\", function( $rootScope, $scope, $timeout, Utils ) {\n\t\tvar interval;\n\n\t\t$scope.toggleDoor = Utils.toggleDoor;\n\n\t\t$scope.$on( \"$ionicView.beforeLeave\", function() {\n\t\t\tclearInterval( interval );\n\t\t} );\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tinterval = setInterval( Utils.updateController, 3000 );\n\t\t} );\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\t$scope.$apply();\n\t\t\t} );\n\t\t} );\n\t} );\n\n/* global angular, window */\n\n// OpenGarage\nangular.module( \"opengarage.utils\", [] )\n    .factory( \"Utils\", [ \"$injector\", \"$rootScope\", function( $injector, $rootScope ) {\n\n\t\tvar isFireFox = /Firefox/.test( window.navigator.userAgent ),\n\t\t\tisIE = /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ),\n\n\t        // Define storage wrapper functions\n\t        storage = {\n\t            get: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var data = {},\n                        i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            data[ query[ i ] ] = localStorage.getItem( query[ i ] );\n                        }\n                    }\n\n                    callback( data );\n\t            },\n\t            set: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n                    if ( typeof query === \"object\" ) {\n                        for ( i in query ) {\n                            if ( query.hasOwnProperty( i ) ) {\n                                localStorage.setItem( i, query[ i ] );\n                            }\n                        }\n                    }\n\n                    callback( true );\n\t            },\n\t            remove: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            localStorage.removeItem( query[ i ] );\n                        }\n                    }\n\n                    callback( true );\n\t            }\n\t        },\n\t\t\tintToIP = function( int ) {\n\t\t\t\treturn ( int % 256 ) + \".\" + ( ( int / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) / 256 >> 0 );\n\t\t\t},\n\t        getControllerSettings = function( callback, ip, token ) {\n\t\t\t\tif ( !ip && !token && !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/query\",\n\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\turl: \"http://\" + ( ip || $rootScope.activeController.ip ) + \"/jc\",\n\t\t\t\t\t\tsuppressLoader: ip ? false : true\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\t\t\t\t\t\t\tvar filter = $filter( \"filter\" );\n\n\t\t\t\t\t\t\tresult = result.data[ 0 ];\n\t\t\t\t\t\t\tcallback( {\n\t\t\t\t\t\t\t\tname: result.name,\n\t\t\t\t\t\t\t\tdoor: parseInt( filter( result.pins, { \"pin\": 0 } )[ 0 ].value ),\n\t\t\t\t\t\t\t\tdist: parseInt( filter( result.pins, { \"pin\": 3 } )[ 0 ].value ),\n\t\t\t\t\t\t\t\trcnt: parseInt( filter( result.pins, { \"pin\": 4 } )[ 0 ].value ),\n\t\t\t\t\t\t\t\tlastUpdate: new Date().getTime()\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.data.lastUpdate = new Date().getTime();\n\t\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        getControllerOptions = function( callback, ip, showLoader ) {\n\t\t\t\tif ( ( !ip && !$rootScope.activeController ) || ( $rootScope.activeController && !$rootScope.activeController.ip ) ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + ( ip || $rootScope.activeController.ip ) + \"/jo\",\n\t                suppressLoader: showLoader ? false : true\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        updateController = function() {\n\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\tvar controller = angular.copy( $rootScope.activeController ),\n\t\t\t\t\tsave = function( data ) {\n\t\t\t\t\t\t$rootScope.connected = true;\n\t\t\t\t\t\tangular.extend( controller, data );\n\t\t\t\t\t};\n\n\t\t\t\t$q.when()\n\t\t\t\t\t.then( function() { return getControllerSettings( save ); } )\n\t\t\t\t\t.then( function() { return getControllerOptions( save ); } )\n\t\t\t\t\t.then( function() {\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": controller.mac } ) || [] )[ 0 ] );\n\n\t\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = controller;\n\t\t\t\t\t\t\t$rootScope.activeController = controller;\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllerUpdated\" );\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t        },\n\t\t\taddController = function( data, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( !data.token && ( !data.ip || !data.password ) ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Both an IP and password are required.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( data.token && data.token.length !== 32 ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>A valid Blynk token is required. Please verify your token and try again.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tgetControllerSettings( function( result ) {\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to find device. Please verify the IP/password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( result.mac ) {\n\t\t\t\t\t\tresult.ip = data.ip;\n\t\t\t\t\t\tresult.password = data.password;\n\n\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgetControllerOptions( function( reply ) {\n\t\t\t\t\t\t\tangular.extend( result, reply );\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t}, data.ip );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.token ) {\n\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + data.token + \"/get/V2\",\n\t\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t\t} ).then( function( reply ) {\n\t\t\t\t\t\t\treply = reply.data.pop().split( \" \" )[ 1 ].split( \"_\" )[ 1 ];\n\t\t\t\t\t\t\tresult.mac = \"5C:CF:7F\" + reply.match( /.{1,2}/g ).join( \":\" );\n\t\t\t\t\t\t\tresult.auth = data.token;\n\n\t\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdata.token ? null : data.ip,\n\t\t\t\tdata.token ? data.token : null\n\t\t\t\t);\n\t\t\t},\n\t\t\tcheckNewController = function( callback ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/js\",\n\t                suppressLoader: true,\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tretryCount: 0\n\t\t\t\t\t}\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( !result.data.ssids ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\t\t\tscope.data = {};\n\t\t\t\t\t\tscope.save = function() {\n\t\t\t\t\t\t\tscope.modal.hide();\n\t\t\t\t\t\t\tconnectNewController( scope.data );\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.ssids = result.data.ssids;\n\t\t\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/newControllerSetup.html\", {\n\t\t\t\t\t\t\tscope: scope,\n\t\t\t\t\t\t\tanimation: \"slide-in-up\"\n\t\t\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\t\t\tscope.modal = modal;\n\t\t\t\t\t\t\tmodal.show();\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tconnectNewController = function( data ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/cc?ssid=\" + encodeURIComponent( data.ssid ) + \"&pass=\" + encodeURIComponent( data.password )\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( result.data.result === 1 ) {\n\t\t\t\t\t\t\tsetTimeout( saveNewController, 2000 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid SSID/password combination. Please try again.</p>\"\n\t\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to reach controller. Please try again.</p>\"\n\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tsaveNewController = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/jt\"\n\t            } ).then( function( result ) {\n\t\t\t\t\tif ( result.data.ip === 0 ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Controller was unable to connect. Please check your SSID and password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Controller succesfully connected! Please wait while the device reboots.</p>\"\n\t\t\t\t\t} );\n\n\t\t\t\t\t$rootScope.controllers.push( {\n\t\t\t\t\t\tip: intToIP( result.data.ip ),\n\t\t\t\t\t\tpassword: \"opendoor\",\n\t\t\t\t\t\tname: \"My OpenGarage\"\n\t\t\t\t\t} );\n\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tscanLocalNetwork = function( callback ) {\n\t\t\t\tif ( !window.networkinterface ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.networkinterface.getIPAddress( function( router ) {\n\t\t\t\t\tif ( !router ) {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t\trouter = router.split( \".\" );\n\t\t\t\t\trouter.pop();\n\n\t\t\t\t\tvar baseip = router.join( \".\" ),\n\t\t\t\t\t\tcheck = function( ip ) {\n\t\t\t\t\t\t\treturn $http( {\n\t\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\t\turl: \"http://\" + baseip + \".\" + ip + \"/jc\",\n\t\t\t\t\t\t\t\t\tsuppressLoader: true,\n\t\t\t\t\t\t\t\t\ttimeout: 6000,\n\t\t\t\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\t\t\t\tretryCount: 0\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.then( function( result ) {\n\t\t\t\t\t\t\t\t\tif ( result.data && result.data.mac ) {\n\t\t\t\t\t\t\t\t\t\tmatches.push( baseip + \".\" + ip );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.catch( function() {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tqueue = [], matches = [], i;\n\n\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\n\t\t\t\t    for ( i = 1; i <= 244; i++ ) {\n\t\t\t\t        queue.push( check( i ) );\n\t\t\t\t    }\n\n\t\t\t\t    $q.all( queue ).then( function() {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\tcallback( matches );\n\t\t\t\t    } );\n\t\t\t\t} );\n\t\t\t},\n\t\t\trequestPassword = function( callback ) {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Enter Controller Password\",\n\t\t\t\t\ttemplate: \"Enter your controller's password below:\",\n\t\t\t\t\tinputType: \"password\",\n\t\t\t\t\tinputPlaceholder: \"Controller Password\"\n\t\t\t\t} ).then( function( password ) {\n\t\t\t\t\tcallback( password );\n\t\t\t\t} );\n\t\t\t},\n\t\t\t$http, $q, $filter, $ionicPopup, $ionicModal;\n\n\t    if ( isFireFox ) {\n\t\t\tHTMLElement.prototype.click = function() {\n\t\t\t\tvar evt = this.ownerDocument.createEvent( \"MouseEvents\" );\n\t\t\t\tevt.initMouseEvent( \"click\", true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null );\n\t\t\t\tthis.dispatchEvent( evt );\n\t\t\t};\n\t    }\n\n\t    // Return usable functions\n\t    return {\n\t\t\tisIE: isIE,\n\t        storage: storage,\n\t        getControllerSettings: getControllerSettings,\n\t        getControllerOptions: getControllerOptions,\n\t        updateController: updateController,\n\t        checkNewController: checkNewController,\n\t\t\tshowAddController: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.data = {\n\t\t\t\t\tcanScan: window.networkinterface ? true : false\n\t\t\t\t};\n\t\t\t\tscope.scan = function() {\n\t\t\t\t\tscanLocalNetwork( function( result ) {\n\t\t\t\t\t\tif ( !result || !result.length ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>No devices detected on your network</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscope.data.foundControllers = result;\n\t\t\t\t\t} );\n\t\t\t\t};\n\t\t\t\tscope.save = function( ip ) {\n\t\t\t\t\tpopup.close();\n\t\t\t\t\trequestPassword( function( password ) {\n\t\t\t\t\t\taddController( {\n\t\t\t\t\t\t\tip: ip,\n\t\t\t\t\t\t\tpassword: password\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tvar popup = $ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/addController.html\",\n\t\t\t\t\ttitle: \"Add Controller\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Add</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\",\n\t\t\t\t\t\t\tonTap: function( e ) {\n\t\t\t\t\t\t\t\tif ( !scope.data.ip || !scope.data.password ) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} );\n\n\t\t\t\tpopup.then(\n\t\t\t\t\tfunction( isValid ) {\n\t\t\t\t\t\tif ( isValid ) {\n\t\t\t\t\t\t\taddController( scope.data, callback );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tshowAddBlynk: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Add Controller by Blynk\",\n\t\t\t\t\ttemplate: \"Enter your Blynk Auth token below:\",\n\t\t\t\t\tinputType: \"text\",\n\t\t\t\t\tinputPlaceholder: \"Your Blynk Auth token\"\n\t\t\t\t} ).then( function( token ) {\n\t\t\t\t\tif ( token ) {\n\t\t\t\t\t\taddController( { token: token }, callback );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\ttoggleDoor: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( $rootScope.activeController && $rootScope.activeController.auth ) {\n\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( $rootScope.activeController.auth + \"/update/V1?value=1\" ),\n\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t} ).then( function() {\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( $rootScope.activeController.auth + \"/update/V1?value=0\" ),\n\t\t\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t\t\t} ).then( function() {\n\t\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}, 1000 );\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http.get( \"http://\" + $rootScope.activeController.ip + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&click=1\" );\n\t\t\t\t}\n\n\t            promise.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\trestartController: function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t$ionicPopup.confirm( {\n\t\t\t\t\t\ttitle: \"Restart Controller?\",\n\t\t\t\t\t\ttemplate: \"<p class='center'>Are you sure you want to restart the controller?</p>\"\n\t\t\t\t\t} ).then( function( result ) {\n\t\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t\t$http.get( \"http://\" + $rootScope.activeController.ip + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&reboot=1\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsaveOptions: function( settings, callback ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + $rootScope.activeController.ip + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\tparams: settings,\n\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tchangePassword: function() {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.pwd = {};\n\n\t\t\t\t$ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/changePassword.html\",\n\t\t\t\t\ttitle: \"Change Password\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Go</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} ).then( function() {\n\t\t\t\t\tif ( !scope.pwd.nkey || !scope.pwd.ckey || scope.pwd.nkey !== scope.pwd.ckey  ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t            $http( {\n\t\t                method: \"GET\",\n\t\t                url: \"http://\" + $rootScope.activeController.ip + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\t\tparams: scope.pwd,\n\t\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t\t            } ).then( function() {\n\t\t\t\t\t\t$rootScope.activeController.password = scope.pwd.nkey;\n\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Password updated succesfully!</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tgetLogs: function( callback ) {\n\t\t\t\tif ( !$rootScope.activeController || !$rootScope.activeController.ip ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + $rootScope.activeController.ip + \"/jl\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data.logs.sort( function( a, b ) { return b[ 0 ] - a[ 0 ]; } ) );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t    };\n} ] );\n"]}