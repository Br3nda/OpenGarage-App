{"version":3,"sources":["app.min.js"],"names":["angular","module","run","$state","$ionicPlatform","$ionicScrollDelegate","$ionicHistory","$location","$document","$window","$rootScope","$filter","$ionicLoading","$ionicPopup","$timeout","Utils","Cloud","ready","open","url","window","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleLightContent","backgroundColorByHexString","element","on","scrollTop","geofence","hasGeofence","startGeofence","callback","initialize","then","getWatched","fences","geoFences","JSON","parse","handleGeofence","geofences","notification","$apply","forEach","geo","controller","controllers","mac","data","id","door","toggleDoor","auth","onTransitionReceived","onNotificationClicked","navigator","splashscreen","hide","err","connected","version","appVersion","loadingCount","$on","e","canceller","resolve","noop","show","template","title","checkNewController","sync","firstLoadHandler","event","preventDefault","storage","get","activeController","go","updateController","length","cloudToken","$broadcast","content","document","getElementById","innerWidth","width","config","$stateProvider","$urlRouterProvider","$httpProvider","$compileProvider","$ionicConfigProvider","test","userAgent","platform","spinner","icon","backButton","previousTitleText","text","scrolling","jsScrolling","aHrefSanitizationWhitelist","imgSrcSanitizationWhitelist","state","templateUrl","abstract","views","menuContent","checkValid","$q","total","filterFilter","invalidOrg","remove","reject","set","stringify","interceptors","push","$injector","request","suppressLoader","defer","timeout","promise","retryCount","response","responseError","error","$$state","status","canceled","$http","retryFailed","forwardCache","filter","items","filterOn","isUndefined","isArray","newItems","extractValueToCompare","item","isObject","isString","isDuplicate","i","equals","directive","restrict","replace","scope","rule","link","map","marker","circle","updateRule","addOrUpdate","direction","latitude","start","lat","longitude","lng","radius","transitionType","openAppOnClick","updateMarker","setMap","google","maps","Marker","position","updateRadius","Circle","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","center","parseInt","updateMap","enable","setTimeout","Map","querySelectorAll","zoom","streetViewControl","mapTypeControl","addListener","latLng","$watch","currentRule","geolocation","getCurrentPosition","coords","factory","$httpParamSerializerJQLike","$ionicActionSheet","requestAuth","$new","buttons","type","onTap","username","password","isValid","login","syncStart","user","pass","method","headers","Content-Type","action","result","token","cloudDataToken","sjcl","codec","hex","fromBits","hash","sha256","isSynced","loggedin","logout","getSites","sites","Object","keys","finish","saveSites","titleText","cancelText","buttonClicked","index","concat","local","undefined","handleInvalidDataToken","controllerType","success","message","handleExpiredLogin","decrypt","encodeURIComponent","encrypt","prompt","subTitle","inputType","inputPlaceholder","confirm","getTokenUser","atob","split","$scope","submit","alert","skipCloud","$ionicModal","showDelete","image","cropped","fileInput","fromTemplateUrl","modal","crop","hasCamera","camera","getPicture","setController","nextViewOptions","historyRoot","deleteController","indexOf","splice","moveItem","fromIndex","toIndex","getTime","timestamp","Date","toLocaleString","selectPhoto","$event","stopPropagation","parent","reset","one","file","files","match","reader","FileReader","onload","evt","target","readAsDataURL","click","uploadPhoto","changeSync","getLogs","reply","current","day","isLocal","toDateString","isDivider","logs","settings","changePassword","restart","restartController","saveOptions","getControllerOptions","mod","fwv","$ionicSideMenuDelegate","showAddController","showAddBlynk","closeMenu","toggleLeft","interval","changeController","to","clearInterval","setInterval","home","away","isAndroid","ionic","Platform","isFireFox","isIE","query","hasOwnProperty","localStorage","getItem","setItem","removeItem","intToIP","int","getControllerSettings","ip","name","pins","pin","value","dist","rcnt","lastUpdate","showLoader","copy","save","extend","when","addController","pop","join","ssids","connectNewController","animation","ssid","saveNewController","scanLocalNetwork","networkinterface","getIPAddress","router","baseip","check","matches","queue","all","requestPassword","HTMLElement","prototype","this","ownerDocument","createEvent","initMouseEvent","defaultView","dispatchEvent","canScan","scan","foundControllers","popup","close","params","paramSerializer","pwd","nkey","ckey","sort","a","b"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular, google */\n\n// OpenGarage\n// Controllers are found in controllers.js and utilities are located in utils.js\nangular.module( \"opengarage\", [ \"ionic\", \"uiCropper\", \"opengarage.controllers\", \"opengarage.utils\", \"opengarage.cloud\" ] )\n\t.run( function( $state, $ionicPlatform, $ionicScrollDelegate, $ionicHistory, $location, $document, $window, $rootScope, $filter, $ionicLoading, $ionicPopup, $timeout, Utils, Cloud ) {\n\n\t\t// Ready function fires when the DOM is ready and after deviceready event is fired if Cordova is being used\n\t\t$ionicPlatform.ready( function() {\n\n\t\t\t// Map inAppBrowser to rootScope\n\t\t\t$rootScope.open = function( url ) {\n\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t};\n\n\t\t\t// Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n\t\t\t// for form inputs)\n\t\t\tif ( window.cordova && window.cordova.plugins && window.cordova.plugins.Keyboard && window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar ) {\n\t\t\t\twindow.cordova.plugins.Keyboard.hideKeyboardAccessoryBar( true );\n\t\t\t}\n\t\t\tif ( window.StatusBar ) {\n\n\t\t\t\t// Use white text/icons on the status bar\n\t\t        window.StatusBar.styleLightContent();\n\n\t\t        //Change the status bar color to match the header\n                window.StatusBar.backgroundColorByHexString( \"#444\" );\n\n\t\t        // Scroll to the top of the page when the status bar is tapped\n\t\t\t\tangular.element( $window ).on( \"statusTap\", function() {\n\t\t\t\t\t$ionicScrollDelegate.scrollTop();\n\t\t        } );\n\t\t\t}\n\n\t\t\tif ( window.geofence ) {\n\t\t\t\t$rootScope.hasGeofence = true;\n\n\t\t\t\t$rootScope.startGeofence = function( callback ) {\n\t\t\t\t\twindow.geofence.initialize().then( function() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t} );\n\n\t\t\t\tvar handleGeofence = function( geofences ) {\n\t\t\t\t\tif ( geofences ) {\n\n\t\t\t\t\t\t// Allow handler to process notification click event as well\n\t\t\t\t\t\tif ( geofences.notification ) {\n\t\t\t\t\t\t\tgeofences = [ geofences ];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.$apply( function() {\n\t\t\t\t\t\t\tgeofences.forEach( function( geo ) {\n\t\t\t\t\t\t\t\tvar controller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": geo.notification.data.controller } );\n\n\t\t\t\t\t\t\t\tif ( controller &&\n\t\t\t\t\t\t\t\t\t( geo.notification.id === \"open\" && controller.door === 0 ) &&\n\t\t\t\t\t\t\t\t\t( geo.notification.id === \"close\" && controller.door === 1 ) ) {\n\t\t\t\t\t\t\t\t\t\tUtils.toggleDoor( controller.auth );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.onTransitionReceived = handleGeofence;\n\t\t\t\twindow.geofence.onNotificationClicked = handleGeofence;\n\t\t\t}\n\n\t\t    // Hide the splash screen after 500ms of the app being ready\n\t\t    $timeout( function() {\n\t\t        try {\n\t\t            navigator.splashscreen.hide();\n\t\t        } catch ( err ) {}\n\t\t    }, 500 );\n\t\t} );\n\n\t\t// Define connected state of current controller\n\t\t$rootScope.connected = false;\n\n\t\t// Define version, build number and debug state\n\t\t$rootScope.version = window.appVersion;\n\n\t    // Define total loading requests\n\t    $rootScope.loadingCount = 0;\n\n\t    // Initialize controllers array\n\t    $rootScope.controllers = [];\n\n\t\t// Automatically show a loading message on any AJAX request\n\t\t$rootScope.$on( \"loading:show\", function( e, data ) {\n\n\t\t\t$rootScope.loadingCount++;\n\t\t\t$rootScope.canceller = data ? data.canceller.resolve : angular.noop;\n\t\t\t$ionicLoading.show( {\n\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='$root.canceller()'>Cancel</button>\"\n\t\t\t} );\n\t\t} );\n\n\t\t// Automatically hide the loading message after an AJAX request\n\t\t$rootScope.$on( \"loading:hide\", function() {\n\n\t\t\t$rootScope.loadingCount--;\n\t\t\tif ( $rootScope.loadingCount <= 0 ) {\n\t\t\t\t$rootScope.loadingCount = 0;\n\t\t\t\t$ionicLoading.hide();\n\t\t\t}\n\t\t} );\n\n\t\t// Keep the page title locked as the app name\n\t\t$rootScope.$on( \"$ionicView.afterEnter\", function() {\n\t\t\t$document[ 0 ].title = \"OpenGarage\";\n\t\t} );\n\n\t\tangular.element( $document ).on( \"resume\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\tUtils.checkNewController();\n\t\t\t\tCloud.sync();\n\t\t\t}, 100 );\n\t\t} );\n\n\t\t// Handle loading of the first page\n\t\tvar firstLoadHandler = $rootScope.$on( \"$stateChangeStart\", function( event ) {\n\n\t\t\t// Unbind event handler so this check is only performed on the first app load\n\t\t    firstLoadHandler();\n\n\t\t    // Prevent any page change from occurring\n\t        event.preventDefault();\n\n\t\t    Utils.storage.get( [ \"activeController\", \"controllers\", \"cloudToken\" ], function( data ) {\n\n\t\t\t\ttry {\n\t\t\t\t\t$rootScope.controllers = JSON.parse( data.controllers );\n\t\t\t\t\t$rootScope.activeController = JSON.parse( data.activeController );\n\t\t\t\t} catch ( err ) {}\n\n\t\t\t\tif ( !$rootScope.controllers ) {\n\t\t\t\t\t$rootScope.controllers = [];\n\t\t\t\t}\n\n\t\t\t\tCloud.sync();\n\n\t\t\t\t// Restore the active controller, if available\n\t\t        if ( $rootScope.activeController && typeof $rootScope.activeController === \"object\" ) {\n\n\t\t\t\t\t// If a user object is cached, proceed to load the app while updating user object in the background\n\t\t\t\t\t$state.go( \"app.home\" );\n\n\t\t\t\t\tUtils.updateController();\n\t\t        } else {\n\t\t\t\t\tif ( $rootScope.controllers.length || data.cloudToken ) {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"login\" );\n\t\t\t\t\t}\n\t\t        }\n\t\t    } );\n\n\t\t    Utils.checkNewController();\n\t\t} );\n\n\t\t// Resize the main content view to fit when the window changes size\n\t\tangular.element( window ).on( \"resize\", function() {\n\t\t\t$rootScope.$broadcast( \"window:resize\" );\n\t\t\tvar content = document.getElementById( \"mainContent\" );\n\t\t\tif ( content && window.innerWidth > 768 ) {\n\t\t\t\tcontent.width = window.innerWidth - 275;\n\t\t\t}\n\t\t} );\n\t} )\n\n\t.config( function( $stateProvider, $urlRouterProvider, $httpProvider, $compileProvider, $ionicConfigProvider ) {\n\n\t\tif ( /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ) ) {\n\n\t\t\t// Change the default spinner for IE to android which has JS based animation\n\t\t\t$ionicConfigProvider.platform.default.spinner.icon( \"android\" );\n\t\t}\n\n\t\t// Change the back text to always say 'Back'\n\t\t$ionicConfigProvider.backButton.previousTitleText( false ).text( \"Back\" );\n\n\t\t// Use native scrolling for FireFox\n\t\tif ( /Firefox/.test( navigator.userAgent ) ) {\n\t\t\t$ionicConfigProvider.scrolling.jsScrolling( false );\n\t\t}\n\n\t\t// Modify Ionic's allowed href protocols to allow Firefox, Blackberry, iOS and Chrome support\n\t\t$compileProvider.aHrefSanitizationWhitelist( /^\\s*(https?|ftp|mailto|chrome-extension|app|local|file):/ );\n\n\t\t// Modify Ionic's allowed image source protocols\n\t\t$compileProvider.imgSrcSanitizationWhitelist( /^\\s*(https?|ftp|file|content|blob|ms-appx|x-wmapp0|chrome-extension|app|local):|data:image\\// );\n\n\t\t// Define all available routes and their associated controllers\n\t\t$stateProvider\n\t\t\t.state( \"login\", {\n\t\t\t\turl: \"/login\",\n\t\t\t\ttemplateUrl: \"templates/login.html\",\n\t\t\t\tcontroller: \"LoginCtrl\"\n\t\t\t} )\n\n\t\t\t// Used as the parent route after authentication is complete allowing the same header\n\t\t\t// and side menu's to be used throughout all child views\n\t\t\t.state( \"app\", {\n\t\t\t\turl: \"/app\",\n\t\t\t\tabstract: true,\n\t\t\t\ttemplateUrl: \"templates/menu.html\",\n\t\t\t\tcontroller: \"MenuCtrl\"\n\t\t\t} )\n\n\t\t\t.state( \"app.home\", {\n\t\t\t\turl: \"/home\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/home.html\",\n\t\t\t\t\t\tcontroller: \"HomeCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $timeout, $q, $state, $rootScope, $filter, Utils ) {\n\t\t\t\t\t\tvar total = $rootScope.controllers.length,\n\t\t\t\t\t\t\tfilterFilter = $filter( \"filter\" ),\n\t\t\t\t\t\t\tinvalidOrg = ( $rootScope.activeController && filterFilter( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ).length === 0 ) ? true : false;\n\n\t\t\t\t\t\tif ( !$rootScope.activeController && total === 1 ) {\n\t\t\t\t\t\t\t$rootScope.activeController = $rootScope.controllers[ 0 ];\n\t\t\t\t\t\t\tUtils.updateController();\n\t\t\t\t\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !$rootScope.activeController || invalidOrg ) {\n\n\t\t\t\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\t\t\t\tUtils.storage.remove( \"activeController\" );\n\n\t\t\t\t\t\t\t// If the active controller is not found in the controller list, show the select controller screen\n\t\t\t\t\t\t\t$timeout( function() {\n\t\t\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.rules\", {\n\t\t\t\turl: \"/rules\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/rules.html\",\n\t\t\t\t\t\tcontroller: \"RulesCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.controllerSelect\", {\n\t\t\t\turl: \"/controllerSelect\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/controllerSelect.html\",\n\t\t\t\t\t\tcontroller: \"ControllerSelectCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.history\", {\n\t\t\t\turl: \"/history\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/history.html\",\n\t\t\t\t\t\tcontroller: \"HistoryCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.settings\", {\n\t\t\t\turl: \"/settings\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/settings.html\",\n\t\t\t\t\t\tcontroller: \"SettingsCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.help\", {\n\t\t\t\turl: \"/help\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/help.html\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t// Defines the otherwise route which will redirect any invalid URL back to the start page\n\t\t\t.state( \"otherwise\", {\n\t\t\t\turl: \"*path\",\n\t\t\t\ttemplate: \"\",\n\t\t\t\tcontroller: function( $state, $rootScope ) {\n\n\t\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Add an HTTP interceptor\n\t\t$httpProvider.interceptors.push( function( $rootScope, $q, $injector ) {\n\t\t\treturn {\n\t\t\t\trequest: function( config ) {\n\n\t\t\t\t\t// When an AJAX request to the controller is started, fire an event to show a loading message\n\t\t\t\t\tif ( !config.suppressLoader ) {\n\n\t\t\t\t\t\t// Change timeout to a promise we can cancel\n\t\t\t\t\t\tvar canceller = $q.defer();\n\n\t\t\t\t\t\t// Set the timeout to the canceller promise\n\t\t\t\t\t\tconfig.timeout = canceller.promise;\n\n\t\t\t\t\t\t// Set the current retry count to 0\n\t\t\t\t\t\tif ( typeof config.retryCount !== \"number\" ) {\n\t\t\t\t\t\t\tconfig.retryCount = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\", { canceller: canceller } );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn config;\n\t\t\t\t},\n\t\t\t\tresponse: function( response ) {\n\n\t\t\t\t\t// If the request is to the controller, broadcast a hide loading message\n\t\t\t\t\tif ( !response.config.suppressLoader ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t\tresponseError: function( error ) {\n\n\t\t\t\t\t// If the timeout value is an object and is resolved, mark request as user canceled\n\t\t\t\t\tif ( error.config.timeout && error.config.timeout.$$state && error.config.timeout.$$state.status === 1 ) {\n\t\t\t\t\t\terror.canceled = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !error.config.suppressLoader ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the request timed out and is not user canceled, retry the request up to three times\n\t\t\t\t\tif ( error.status <= 0 && !error.canceled ) {\n\t\t\t\t\t\tif ( error.config.retryCount < 3 ) {\n\t\t\t\t\t\t\tvar $http = $injector.get( \"$http\" );\n\n\t\t\t\t\t\t\terror.config.retryCount++;\n\n\t\t\t\t\t\t\t// Return the new promise object\n\t\t\t\t\t\t\treturn $http( error.config );\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// After three timeouts, assume the network is down\n\t\t\t\t\t\t\terror.retryFailed = true;\n\t\t\t\t\t\t\terror.canceled = true;\n\n\t\t\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t}\n\t\t\t};\n\t\t} );\n\n\t\t// Inform Ionic we want to cache forward views\n\t\t$ionicConfigProvider.views.forwardCache( true );\n\t} )\n\n\t.filter( \"unique\", function() {\n\t\treturn function( items, filterOn ) {\n\t\t\tif ( filterOn === false ) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif ( ( filterOn || angular.isUndefined( filterOn ) ) && angular.isArray( items ) ) {\n\t\t\t\tvar newItems = [],\n\t\t\t\t\textractValueToCompare = function( item ) {\n\t\t\t\t\t\tif ( angular.isObject( item ) && angular.isString( filterOn ) ) {\n\t\t\t\t\t\t\treturn item[ filterOn ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tangular.forEach( items, function( item ) {\n\t\t\t\t\tvar isDuplicate = false;\n\n\t\t\t\t\tfor ( var i = 0; i < newItems.length; i++ ) {\n\t\t\t\t\t\tif ( angular.equals( extractValueToCompare( newItems[ i ] ), extractValueToCompare( item ) ) ) {\n\t\t\t\t\t\t\tisDuplicate = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( !isDuplicate ) {\n\t\t\t\t\t\tnewItems.push( item );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\titems = newItems;\n\t\t\t}\n\t\treturn items;\n\t\t};\n\t} )\n\n\t.directive( \"geoRuleSetup\", function( $rootScope, $filter ) {\n\t\treturn {\n\t\t\trestrict: \"E\",\n\t\t\treplace: true,\n\t\t\tscope: {\n\t\t\t\trule: \"=\"\n\t\t\t},\n\t\t\ttemplateUrl: \"templates/geoRuleSetup.html\",\n\t\t\tlink: function( scope, element ) {\n\t\t\t\tvar map, marker, circle;\n\n\t\t\t\tscope.updateRule = function() {\n\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\twindow.geofence.addOrUpdate( {\n\t\t\t\t\t\t\tid: scope.rule.direction,\n\t\t\t\t\t\t\tlatitude: scope.rule.start.lat,\n\t\t\t\t\t\t\tlongitude: scope.rule.start.lng,\n\t\t\t\t\t\t\tradius: scope.rule.radius,\n\t\t\t\t\t\t\ttransitionType: scope.rule.direction === \"open\" ? 1 : 2,\n\t\t\t\t\t\t\tnotification: {\n\t\t\t\t\t\t\t\ttitle: \"OpenGarage\",\n\t\t\t\t\t\t\t\ttext: \"Trying to \" + scope.rule.direction + \" the garage door...\",\n\t\t\t\t\t\t\t\topenAppOnClick: true,\n\t\t\t\t\t\t\t\tdata: { controller: $rootScope.activeController.mac }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tscope.updateMarker = function() {\n\t\t\t\t\tif ( marker ) {\n\t\t\t\t\t\tmarker.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tmarker = new google.maps.Marker( {\n\t\t\t\t\t\tposition: scope.rule.start,\n\t\t\t\t\t\tmap: map\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateRadius = function() {\n\t\t\t\t\tif ( circle ) {\n\t\t\t\t\t\tcircle.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tcircle = new google.maps.Circle( {\n\t\t\t\t\t\tstrokeColor: \"#FF0000\",\n\t\t\t\t\t\tstrokeOpacity: 0.8,\n\t\t\t\t\t\tstrokeWeight: 2,\n\t\t\t\t\t\tfillColor: \"#FF0000\",\n\t\t\t\t\t\tfillOpacity: 0.35,\n\t\t\t\t\t\tmap: map,\n\t\t\t\t\t\tcenter: scope.rule.start,\n\t\t\t\t\t\tradius: parseInt( scope.rule.radius )\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateMap = function() {\n\t\t\t\t\tif ( !scope.rule.enable ) {\n\t\t\t\t\t\twindow.geofence.remove( scope.rule.direction, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\tmap = new google.maps.Map( element[ 0 ].querySelectorAll( \".map\" )[ 0 ], {\n\t\t\t\t\t\t\tzoom: 16,\n\t\t\t\t\t\t\tstreetViewControl: false,\n\t\t\t\t\t\t\tmapTypeControl: false,\n\t\t\t\t\t\t\tcenter: scope.rule.start\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tgoogle.maps.event.addListener( map, \"click\", function( e ) {\n\t\t\t\t\t\t\tscope.rule.start = { lat: e.latLng.lat(), lng: e.latLng.lng() };\n\t\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t}, 100 );\n\t\t\t\t};\n\n\t\t\t\tscope.$watch( \"rule\", function() {\n\t\t\t\t\tvar currentRule = $filter( \"filter\" )( $rootScope.geoFences, { \"id\": scope.rule.direction } )[ 0 ];\n\n\t\t\t\t\tif ( currentRule ) {\n\t\t\t\t\t\tscope.rule.radius = currentRule.radius;\n\t\t\t\t\t\tscope.rule.start = { lat: currentRule.latitude, lng: currentRule.longitude };\n\t\t\t\t\t\tscope.rule.enable = true;\n\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscope.rule.radius = scope.rule.radius || 500;\n\t\t\t\t\t\tscope.rule.start = scope.rule.start || { lat: 30.296519, lng: -97.730185 };\n\t\t\t\t\t\tscope.rule.enable = scope.rule.enable || false;\n\n\t\t\t\t\t\tnavigator.geolocation.getCurrentPosition( function( position ) {\n\t\t\t\t\t\t\tscope.rule.start = { lat: position.coords.latitude, lng: position.coords.longitude };\n\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t}, { timeout: 10000 } );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t} );\n\n/* global angular, sjcl */\n\n// OpenGarage\nangular.module( \"opengarage.cloud\", [ \"opengarage.utils\" ] )\n    .factory( \"Cloud\", [ \"$injector\", \"$rootScope\", \"Utils\", function( $injector, $rootScope, Utils ) {\n\n        var requestAuth = function() {\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n                var scope = $rootScope.$new();\n                scope.data = {};\n\n                $ionicPopup.show( {\n                    templateUrl: \"templates/cloudLogin.html\",\n                    title: \"OpenGarage.io Login\",\n                    scope: scope,\n                    buttons: [\n                        { text: \"Cancel\" },\n                        {\n                            text: \"<b>Login</b>\",\n                            type: \"button-positive\",\n                            onTap: function( e ) {\n                                if ( !scope.data.username || !scope.data.password ) {\n                                    e.preventDefault();\n                                    return;\n                                }\n\n                                return true;\n                            }\n                        }\n                    ]\n                } ).then( function( isValid ) {\n                    if ( isValid ) {\n                        login( scope.data.username, scope.data.password, syncStart );\n                    }\n                } );\n            },\n            login = function( user, pass, callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                $http( {\n                    method: \"POST\",\n                    url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t},\n                    data: $httpParamSerializerJQLike( {\n                        action: \"ajaxLogin\",\n                        username: user,\n                        password: pass\n                    } )\n                } ).then( function( result ) {\n                    if ( typeof result.data.token === \"string\" ) {\n                        Utils.storage.set( {\n                            \"cloudToken\": result.data.token,\n                            \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( pass ) )\n                        } );\n                        $rootScope.isSynced = true;\n                    }\n                    callback( result.data.loggedin );\n                }, function() {\n                    callback( false );\n                } );\n            },\n            logout = function() {\n                Utils.storage.remove( \"cloudToken\" );\n                $rootScope.isSynced = false;\n            },\n            syncStart = function() {\n                $ionicActionSheet = $ionicActionSheet || $injector.get( \"$ionicActionSheet\" );\n\n                getSites( function( sites ) {\n                    if ( JSON.stringify( sites ) === JSON.stringify( $rootScope.controllers ) ) {\n                        return;\n                    }\n\n                    if ( Object.keys( sites ).length > 0 ) {\n\n                        var finish = function() {\n\t\t\t\t\t\t\t$rootScope.controllers = sites;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( sites ) }, saveSites );\n                        };\n\n                        // Handle how to merge when cloud is populated\n                        $ionicActionSheet.show( {\n                            buttons: [\n                                { text: \"Merge\" },\n                                { text: \"Replace local with cloud\" },\n                                { text: \"Replace cloud with local\" }\n                            ],\n                            titleText: \"Select Merge Method\",\n                            cancelText: \"Cancel\",\n                            buttonClicked: function( index ) {\n                                if ( index === 1 ) {\n\n                                    // Replace local with cloud\n                                    finish();\n                                } else if ( index === 2 ) {\n\n                                    // Replace cloud with local\n                                    sites = $rootScope.controllers;\n                                    finish();\n                                } else {\n\t\t\t\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n                                    // Merge data\n                                    sites = $filter( \"unique\" )( $rootScope.controllers.concat( sites ), \"mac\" );\n                                    finish();\n                                }\n                                return true;\n                            }\n                        } );\n                    } else {\n                        saveSites();\n                    }\n                } );\n            },\n            sync = function( callback ) {\n                callback = callback || function() {};\n\n                Utils.storage.get( \"cloudToken\", function( local ) {\n                    if ( typeof local.cloudToken !== \"string\" ) {\n                        return;\n                    }\n\n                    getSites( function( data ) {\n                        if ( data !== false ) {\n                            $rootScope.controllers = data;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( data ) }, callback );\n                        }\n                    } );\n                } );\n            },\n            getSites = function( callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( local ) {\n                    if ( local.cloudToken === undefined || local.cloudToken === null ) {\n                        callback( false );\n                        return;\n                    }\n\n                    if ( local.cloudDataToken === undefined || local.cloudDataToken === null ) {\n                        handleInvalidDataToken();\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        data: $httpParamSerializerJQLike( {\n                            action: \"getSites\",\n                            token: local.cloudToken,\n                            controllerType: \"opengarage\"\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false || result.data.sites === \"\" ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\":result.data.token } );\n                            var sites;\n\n                            try {\n                                sites = sjcl.decrypt( local.cloudDataToken, result.data.sites );\n                            } catch ( err ) {\n                                if ( err.message === \"ccm: tag doesn't match\" ) {\n                                    handleInvalidDataToken();\n                                }\n                                callback( false );\n                            }\n\n                            try {\n                                callback( JSON.parse( sites ) );\n                            } catch ( err ) {\n                                callback( false );\n                            }\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            saveSites = function( callback ) {\n\t\t\t\tif ( typeof callback !== \"function\" ) {\n\t                callback = function() {};\n\t\t\t\t}\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n                    if ( data.cloudToken === null || data.cloudToken === undefined ) {\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        data: $httpParamSerializerJQLike( {\n                            action: \"saveSites\",\n                            token: data.cloudToken,\n                            controllerType: \"opengarage\",\n                            sites: encodeURIComponent( JSON.stringify( sjcl.encrypt( data.cloudDataToken, JSON.stringify( $rootScope.controllers ) ) ) )\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\":result.data.token } );\n                            callback( result.data.success );\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            handleInvalidDataToken = function() {\n                Utils.storage.remove( \"cloudDataToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.prompt( {\n                    title: \"Unable to read cloud data\",\n                    subTitle: \"Enter a valid password to decrypt the data\",\n                    template: \"Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.\",\n                    inputType: \"password\",\n                    inputPlaceholder: \"Password\"\n                } ).then( function( password ) {\n                    Utils.storage.set( {\n                        \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( password ) )\n                    } );\n                    sync();\n                } );\n            },\n            handleExpiredLogin = function() {\n                Utils.storage.remove( \"cloudToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.confirm( {\n                    title: \"OpenGarage.io Login Expired\",\n                    template: \"Click here to re-login to OpenGarage.io\"\n                } ).then( function( result ) {\n                    if ( result ) {\n\n                        requestAuth( function( result ) {\n                            if ( result === true ) {\n                                sync();\n                            }\n                        } );\n\n                    }\n                } );\n            },\n            getTokenUser = function( token ) {\n                return atob( token ).split( \"|\" )[ 0 ];\n            },\n            $http, $httpParamSerializerJQLike, $filter, $ionicPopup, $ionicActionSheet;\n\n        Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n\t\t\tif ( data.cloudToken === null || data.cloudToken === undefined || data.cloudDataToken === undefined || data.cloudDataToken === undefined ) {\n\t\t\t\t$rootScope.isSynced = false;\n\t\t\t} else {\n\t\t\t\t$rootScope.isSynced = true;\n\t\t\t}\n        } );\n\n        $rootScope.$on( \"triggerCloudSave\", saveSites );\n\n        return {\n            requestAuth: requestAuth,\n            login: login,\n            logout: logout,\n            syncStart: syncStart,\n            sync: sync,\n            getSites: getSites,\n            saveSites: saveSites,\n            handleInvalidDataToken: handleInvalidDataToken,\n            handleExpiredLogin: handleExpiredLogin,\n            getTokenUser: getTokenUser\n        };\n    } ] );\n\n/* global angular, ionic */\n\nangular.module( \"opengarage.controllers\", [ \"opengarage.utils\", \"opengarage.cloud\" ] )\n\n\t.controller( \"LoginCtrl\", function( $scope, $rootScope, $state, $ionicPopup, Cloud ) {\n\t\t$scope.data = {};\n\n\t\t$scope.submit = function() {\n\t\t\tif ( !$scope.data.username ) {\n\n\t\t\t\t// If no email is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a username to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else if ( !$scope.data.password ) {\n\n\t\t\t\t// If no password is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a password to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tCloud.login( $scope.data.username, $scope.data.password, function() {\n\t\t\t\t\tCloud.sync( function() {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\t$scope.skipCloud = function() {\n\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t};\n\t} )\n\n\t.controller( \"ControllerSelectCtrl\", function( $scope, $state, $rootScope, $timeout, $filter, $ionicModal, $ionicHistory, Utils, Cloud ) {\n\t\t$scope.data = {\n\t\t\tshowDelete: false,\n\t\t\timage: false,\n\t\t\tcropped: false,\n\t\t\tindex: false\n\t\t};\n\n\t\tvar fileInput = angular.element( document.getElementById( \"photoUpload\" ) );\n\n\t\t$ionicModal.fromTemplateUrl( \"templates/crop.html\", {\n\t\t\tscope: $scope\n\t\t} ).then( function( modal ) {\n\t\t\t$scope.crop = modal;\n\t\t} );\n\n\t\t$scope.hasCamera = navigator.camera && navigator.camera.getPicture ? true : false;\n\n\t\t$scope.setController = function( index ) {\n\t\t\t$rootScope.activeController = $rootScope.controllers[ index ];\n\t\t\t$rootScope.connected = false;\n\t\t\tUtils.updateController();\n\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\n\t\t\t$ionicHistory.nextViewOptions( {\n\t\t\t\thistoryRoot: true\n\t\t\t} );\n\n\t\t\t$state.go( \"app.home\" );\n\t\t};\n\n\t\t$scope.deleteController = function( index ) {\n\t\t\tif ( $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] ) === index ) {\n\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\tUtils.storage.remove( \"activeController\" );\n\t\t\t}\n\n\t\t\t$rootScope.controllers.splice( index, 1 );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\tCloud.saveSites();\n\t\t};\n\n\t\t$scope.moveItem = function( item, fromIndex, toIndex ) {\n\t\t\t$rootScope.controllers.splice( fromIndex, 1 );\n\t\t\t$rootScope.controllers.splice( toIndex, 0, item );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\tCloud.saveSites();\n\t\t};\n\n\t\t$scope.getTime = function( timestamp ) {\n\t\t\treturn new Date( timestamp ).toLocaleString();\n\t\t};\n\n\t\t$scope.selectPhoto = function( $event, index ) {\n\t\t\t$event.stopPropagation();\n\n\t\t\tif ( $scope.data.showDelete ) {\n\t\t\t\tif ( $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] ) === index ) {\n\t\t\t\t\tdelete $rootScope.activeController.image;\n\t\t\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t}\n\n\t\t\t\tdelete $rootScope.controllers[ index ].image;\n\t\t        Utils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\tCloud.saveSites();\n\t\t        $timeout( function() {\n\t\t\t\t\t$scope.$apply();\n\t\t        } );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfileInput.parent()[ 0 ].reset();\n\n\t\t\tfileInput.one( \"change\", function() {\n\t\t\t\tvar file = fileInput[ 0 ].files[ 0 ];\n\n\t\t\t\tif ( !file.type || !file.type.match( \"image.*\" ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\treader.onload = function( evt ) {\n\t\t\t\t\t$scope.data.image = evt.target.result;\n\t\t\t\t\t$scope.data.index = index;\n\t\t\t\t\t$scope.crop.show();\n\t\t\t\t};\n\t\t\t\treader.readAsDataURL( file );\n\t\t\t} );\n\n\t\t\tfileInput[ 0 ].click();\n\t\t};\n\n\t\t$scope.uploadPhoto = function( index ) {\n\t\t\t$scope.crop.hide();\n\n\t\t\tif ( $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] ) === index ) {\n\t\t\t\t$rootScope.activeController.image = $scope.data.cropped;\n\t\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t}\n\n\t\t\t$rootScope.controllers[ index ].image = $scope.data.cropped;\n\t        Utils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\tCloud.saveSites();\n\t        $timeout( function() {\n\t\t\t\t$scope.$apply();\n\t        } );\n\t\t};\n\n\t\t$scope.changeSync = function() {\n\t\t\tif ( $rootScope.isSynced ) {\n\t\t\t\tCloud.logout();\n\t\t\t} else {\n\t\t\t\tCloud.requestAuth();\n\t\t\t}\n\t\t};\n\t} )\n\n\t.controller( \"HistoryCtrl\", function( $scope, $filter, Utils ) {\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getLogs( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\tvar i, current, day;\n\n\t\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\t\tfor ( i = 0; i < reply.length; i++ ) {\n\t\t\t\t\t\tcurrent = new Date( reply[ i ][ 0 ] * 1000 ).toDateString();\n\n\t\t\t\t\t\tif ( current !== day ) {\n\t\t\t\t\t\t\tday = current;\n\t\t\t\t\t\t\treply.splice( i, 0, { isDivider: \"true\", day: current } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$scope.logs = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"SettingsCtrl\", function( $scope, $state, $ionicPopup, Utils ) {\n\t\t$scope.settings = {};\n\n\t\t$scope.changePassword = Utils.changePassword;\n\t\t$scope.restart = Utils.restartController;\n\n\t\t$scope.submit = function() {\n\t\t\tUtils.saveOptions( $scope.settings, function( reply ) {\n\t\t\t\tvar text;\n\n\t\t\t\tif ( reply ) {\n\t\t\t\t\ttext = \"Settings saved successfully!\";\n\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t} else {\n\t\t\t\t\ttext = \"Unable to save settings. Please check the connection to the device and try again.\";\n\t\t\t\t}\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>\" + text + \"</p>\"\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getControllerOptions( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\t\t// Remove unused options to prevent accidental change\n\t\t\t\t\tdelete reply.mod;\n\t\t\t\t\tdelete reply.fwv;\n\t\t\t\t\t$scope.settings = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t}, null, true );\n\t\t} );\n\t} )\n\n\t.controller( \"MenuCtrl\", function( $scope, $rootScope, $ionicActionSheet, $ionicPopup, $ionicSideMenuDelegate, Utils ) {\n\n\t\t$scope.showAddController = function() {\n\t\t\t$ionicActionSheet.show( {\n\t\t\t\tbuttons: [\n\t\t\t\t\t{ text: \"Add by IP\" },\n\t\t\t\t\t{ text: \"Add by Blynk Token\" },\n\t\t\t\t\t{ text: \"Setup New Device\" }\n\t\t\t\t],\n\t\t\t\ttitleText: \"Add Controller\",\n\t\t\t\tcancelText: \"Cancel\",\n\t\t\t\tbuttonClicked: function( index ) {\n\t\t\t\t\tif ( index === 1 ) {\n\t\t\t\t\t\tUtils.showAddBlynk();\n\t\t\t\t\t} else if ( index === 0 ) {\n\t\t\t\t\t\tUtils.showAddController();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\t\t\t\t\t\tUtils.checkNewController( function( result ) {\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Please first connect the power to your OpenGarage. Once complete, connect this device to the wifi network broadcast by the OpenGarage (named OG_XXXXXX) and reopen this app.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\t// Function to close the menu which is fired after a side menu link is clicked.\n\t\t// This is done instead of using the menu-close directive to preserve the root history stack\n\t    $scope.closeMenu = function() {\n            $ionicSideMenuDelegate.toggleLeft( false );\n\t    };\n\t} )\n\n\t.controller( \"HomeCtrl\", function( $rootScope, $scope, $filter, $timeout, Utils ) {\n\t\tvar interval;\n\n\t\t$scope.toggleDoor = Utils.toggleDoor;\n\n\t\t$scope.changeController = function( direction ) {\n\t\t\tvar current = $rootScope.controllers.indexOf( $rootScope.activeController ),\n\t\t\t\tto = current + direction;\n\n\t\t\tif ( to < 0 || to >= $rootScope.controllers.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$rootScope.activeController = $rootScope.controllers[ to ];\n\t\t\t$rootScope.connected = false;\n\t\t\tUtils.updateController();\n\t\t\tUtils.storage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t$timeout( function() {\n\t\t\t\t$scope.$apply();\n\t\t\t} );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeLeave\", function() {\n\t\t\tclearInterval( interval );\n\t\t} );\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tinterval = setInterval( Utils.updateController, 3000 );\n\t\t} );\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\t$scope.$apply();\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"RulesCtrl\", function( $scope ) {\n\t\t$scope.geo = {\n\t\t\thome: { direction: \"open\" },\n\t\t\taway: { direction: \"close\" }\n\t\t};\n\n\t\t$scope.set = function( type ) {\n\t\t\tif ( type === \"home\" ) {\n\t\t\t\t$scope.current = $scope.geo.home;\n\t\t\t} else {\n\t\t\t\t$scope.current = $scope.geo.away;\n\t\t\t}\n\t\t};\n\n\t\t$scope.isAndroid = ionic.Platform.isAndroid();\n\n\t\t$scope.set( \"home\" );\n\t} );\n\n/* global angular, window */\n\n// OpenGarage\nangular.module( \"opengarage.utils\", [] )\n    .factory( \"Utils\", [ \"$injector\", \"$rootScope\", function( $injector, $rootScope ) {\n\n\t\tvar isFireFox = /Firefox/.test( window.navigator.userAgent ),\n\t\t\tisIE = /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ),\n\n\t        // Define storage wrapper functions\n\t        storage = {\n\t            get: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var data = {},\n                        i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            data[ query[ i ] ] = localStorage.getItem( query[ i ] );\n                        }\n                    }\n\n                    callback( data );\n\t            },\n\t            set: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n                    if ( typeof query === \"object\" ) {\n                        for ( i in query ) {\n                            if ( query.hasOwnProperty( i ) ) {\n                                localStorage.setItem( i, query[ i ] );\n                            }\n                        }\n                    }\n\n                    callback( true );\n\t            },\n\t            remove: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            localStorage.removeItem( query[ i ] );\n                        }\n                    }\n\n                    callback( true );\n\t            }\n\t        },\n\t\t\tintToIP = function( int ) {\n\t\t\t\treturn ( int % 256 ) + \".\" + ( ( int / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) / 256 >> 0 );\n\t\t\t},\n\t        getControllerSettings = function( callback, ip, token ) {\n\t\t\t\tif ( !ip && !token && !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/query\",\n\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\turl: \"http://\" + ( ip || $rootScope.activeController.ip ) + \"/jc\",\n\t\t\t\t\t\tsuppressLoader: ip ? false : true\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\t\t\t\t\t\t\tvar filter = $filter( \"filter\" );\n\n\t\t\t\t\t\t\tresult = result.data[ 0 ];\n\t\t\t\t\t\t\tcallback( {\n\t\t\t\t\t\t\t\tname: result.name,\n\t\t\t\t\t\t\t\tdoor: parseInt( filter( result.pins, { \"pin\": 0 } )[ 0 ].value ),\n\t\t\t\t\t\t\t\tdist: parseInt( filter( result.pins, { \"pin\": 3 } )[ 0 ].value ),\n\t\t\t\t\t\t\t\trcnt: parseInt( filter( result.pins, { \"pin\": 4 } )[ 0 ].value ),\n\t\t\t\t\t\t\t\tlastUpdate: new Date().getTime()\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.data.lastUpdate = new Date().getTime();\n\t\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        getControllerOptions = function( callback, ip, showLoader ) {\n\t\t\t\tif ( ( !ip && !$rootScope.activeController ) || ( $rootScope.activeController && !$rootScope.activeController.ip ) ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + ( ip || $rootScope.activeController.ip ) + \"/jo\",\n\t                suppressLoader: showLoader ? false : true\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        updateController = function() {\n\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\tvar controller = angular.copy( $rootScope.activeController ),\n\t\t\t\t\tsave = function( data ) {\n\t\t\t\t\t\t$rootScope.connected = true;\n\t\t\t\t\t\tangular.extend( controller, data );\n\t\t\t\t\t};\n\n\t\t\t\t$q.when()\n\t\t\t\t\t.then( function() { return getControllerSettings( save ); } )\n\t\t\t\t\t.then( function() { return getControllerOptions( save ); } )\n\t\t\t\t\t.then( function() {\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": controller.mac } ) || [] )[ 0 ] );\n\n\t\t\t\t\t\tif ( index >= 0 ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = controller;\n\t\t\t\t\t\t\t$rootScope.activeController = controller;\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllerUpdated\" );\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t        },\n\t\t\taddController = function( data, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( !data.token && ( !data.ip || !data.password ) ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Both an IP and password are required.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( data.token && data.token.length !== 32 ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>A valid Blynk token is required. Please verify your token and try again.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tgetControllerSettings( function( result ) {\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to find device. Please verify the IP/password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( result.mac ) {\n\t\t\t\t\t\tresult.ip = data.ip;\n\t\t\t\t\t\tresult.password = data.password;\n\n\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgetControllerOptions( function( reply ) {\n\t\t\t\t\t\t\tangular.extend( result, reply );\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t}, data.ip );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.token ) {\n\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + data.token + \"/get/V2\",\n\t\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t\t} ).then( function( reply ) {\n\t\t\t\t\t\t\treply = reply.data.pop().split( \" \" )[ 1 ].split( \"_\" )[ 1 ];\n\t\t\t\t\t\t\tresult.mac = \"5C:CF:7F:\" + reply.match( /.{1,2}/g ).join( \":\" );\n\t\t\t\t\t\t\tresult.auth = data.token;\n\n\t\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdata.token ? null : data.ip,\n\t\t\t\tdata.token ? data.token : null\n\t\t\t\t);\n\t\t\t},\n\t\t\tcheckNewController = function( callback ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/js\",\n\t                suppressLoader: true,\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tretryCount: 0\n\t\t\t\t\t}\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( !result.data.ssids ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\t\t\tscope.data = {};\n\t\t\t\t\t\tscope.save = function() {\n\t\t\t\t\t\t\tscope.modal.hide();\n\t\t\t\t\t\t\tconnectNewController( scope.data );\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.ssids = result.data.ssids;\n\t\t\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/newControllerSetup.html\", {\n\t\t\t\t\t\t\tscope: scope,\n\t\t\t\t\t\t\tanimation: \"slide-in-up\"\n\t\t\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\t\t\tscope.modal = modal;\n\t\t\t\t\t\t\tmodal.show();\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tconnectNewController = function( data ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/cc?ssid=\" + encodeURIComponent( data.ssid ) + \"&pass=\" + encodeURIComponent( data.password )\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( result.data.result === 1 ) {\n\t\t\t\t\t\t\tsetTimeout( saveNewController, 2000 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid SSID/password combination. Please try again.</p>\"\n\t\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to reach controller. Please try again.</p>\"\n\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tsaveNewController = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/jt\"\n\t            } ).then( function( result ) {\n\t\t\t\t\tif ( result.data.ip === 0 ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Controller was unable to connect. Please check your SSID and password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Controller succesfully connected! Please wait while the device reboots.</p>\"\n\t\t\t\t\t} );\n\n\t\t\t\t\t$rootScope.controllers.push( {\n\t\t\t\t\t\tip: intToIP( result.data.ip ),\n\t\t\t\t\t\tpassword: \"opendoor\",\n\t\t\t\t\t\tname: \"My OpenGarage\"\n\t\t\t\t\t} );\n\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tscanLocalNetwork = function( callback ) {\n\t\t\t\tif ( !window.networkinterface ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.networkinterface.getIPAddress( function( router ) {\n\t\t\t\t\tif ( !router ) {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t\trouter = router.split( \".\" );\n\t\t\t\t\trouter.pop();\n\n\t\t\t\t\tvar baseip = router.join( \".\" ),\n\t\t\t\t\t\tcheck = function( ip ) {\n\t\t\t\t\t\t\treturn $http( {\n\t\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\t\turl: \"http://\" + baseip + \".\" + ip + \"/jc\",\n\t\t\t\t\t\t\t\t\tsuppressLoader: true,\n\t\t\t\t\t\t\t\t\ttimeout: 6000,\n\t\t\t\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\t\t\t\tretryCount: 0\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.then( function( result ) {\n\t\t\t\t\t\t\t\t\tif ( result.data && result.data.mac ) {\n\t\t\t\t\t\t\t\t\t\tmatches.push( baseip + \".\" + ip );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.catch( function() {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tqueue = [], matches = [], i;\n\n\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\n\t\t\t\t    for ( i = 1; i <= 244; i++ ) {\n\t\t\t\t        queue.push( check( i ) );\n\t\t\t\t    }\n\n\t\t\t\t    $q.all( queue ).then( function() {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\tcallback( matches );\n\t\t\t\t    } );\n\t\t\t\t} );\n\t\t\t},\n\t\t\trequestPassword = function( callback ) {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Enter Controller Password\",\n\t\t\t\t\ttemplate: \"Enter your controller's password below:\",\n\t\t\t\t\tinputType: \"password\",\n\t\t\t\t\tinputPlaceholder: \"Controller Password\"\n\t\t\t\t} ).then( function( password ) {\n\t\t\t\t\tcallback( password );\n\t\t\t\t} );\n\t\t\t},\n\t\t\t$http, $q, $filter, $ionicPopup, $ionicModal;\n\n\t    if ( isFireFox ) {\n\t\t\tHTMLElement.prototype.click = function() {\n\t\t\t\tvar evt = this.ownerDocument.createEvent( \"MouseEvents\" );\n\t\t\t\tevt.initMouseEvent( \"click\", true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null );\n\t\t\t\tthis.dispatchEvent( evt );\n\t\t\t};\n\t    }\n\n\t    // Return usable functions\n\t    return {\n\t\t\tisIE: isIE,\n\t        storage: storage,\n\t        getControllerSettings: getControllerSettings,\n\t        getControllerOptions: getControllerOptions,\n\t        updateController: updateController,\n\t        checkNewController: checkNewController,\n\t\t\tshowAddController: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.data = {\n\t\t\t\t\tcanScan: window.networkinterface ? true : false\n\t\t\t\t};\n\t\t\t\tscope.scan = function() {\n\t\t\t\t\tscanLocalNetwork( function( result ) {\n\t\t\t\t\t\tif ( !result || !result.length ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>No devices detected on your network</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscope.data.foundControllers = result;\n\t\t\t\t\t} );\n\t\t\t\t};\n\t\t\t\tscope.save = function( ip ) {\n\t\t\t\t\tpopup.close();\n\t\t\t\t\trequestPassword( function( password ) {\n\t\t\t\t\t\taddController( {\n\t\t\t\t\t\t\tip: ip,\n\t\t\t\t\t\t\tpassword: password\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tvar popup = $ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/addController.html\",\n\t\t\t\t\ttitle: \"Add Controller\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Add</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\",\n\t\t\t\t\t\t\tonTap: function( e ) {\n\t\t\t\t\t\t\t\tif ( !scope.data.ip || !scope.data.password ) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} );\n\n\t\t\t\tpopup.then(\n\t\t\t\t\tfunction( isValid ) {\n\t\t\t\t\t\tif ( isValid ) {\n\t\t\t\t\t\t\taddController( scope.data, callback );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tshowAddBlynk: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Add Controller by Blynk\",\n\t\t\t\t\ttemplate: \"Enter your Blynk Auth token below:\",\n\t\t\t\t\tinputType: \"text\",\n\t\t\t\t\tinputPlaceholder: \"Your Blynk Auth token\"\n\t\t\t\t} ).then( function( token ) {\n\t\t\t\t\tif ( token ) {\n\t\t\t\t\t\taddController( { token: token }, callback );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\ttoggleDoor: function( auth, callback ) {\n\t\t\t\tif ( typeof auth === \"function\" ) {\n\t\t\t\t\tcallback = auth;\n\t\t\t\t\tauth = null;\n\t\t\t\t}\n\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( auth || ( $rootScope.activeController && $rootScope.activeController.auth ) ) {\n\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( ( auth || $rootScope.activeController.auth ) + \"/update/V1?value=1\" ),\n\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t} ).then( function() {\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( ( auth || $rootScope.activeController.auth ) + \"/update/V1?value=0\" ),\n\t\t\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t\t\t} ).then( function() {\n\t\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}, 1000 );\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http.get( \"http://\" + $rootScope.activeController.ip + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&click=1\" );\n\t\t\t\t}\n\n\t            promise.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\trestartController: function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t$ionicPopup.confirm( {\n\t\t\t\t\t\ttitle: \"Restart Controller?\",\n\t\t\t\t\t\ttemplate: \"<p class='center'>Are you sure you want to restart the controller?</p>\"\n\t\t\t\t\t} ).then( function( result ) {\n\t\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t\t$http.get( \"http://\" + $rootScope.activeController.ip + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&reboot=1\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsaveOptions: function( settings, callback ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + $rootScope.activeController.ip + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\tparams: settings,\n\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tchangePassword: function() {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.pwd = {};\n\n\t\t\t\t$ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/changePassword.html\",\n\t\t\t\t\ttitle: \"Change Password\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Go</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} ).then( function() {\n\t\t\t\t\tif ( !scope.pwd.nkey || !scope.pwd.ckey || scope.pwd.nkey !== scope.pwd.ckey  ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t            $http( {\n\t\t                method: \"GET\",\n\t\t                url: \"http://\" + $rootScope.activeController.ip + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\t\tparams: scope.pwd,\n\t\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t\t            } ).then( function() {\n\t\t\t\t\t\t$rootScope.activeController.password = scope.pwd.nkey;\n\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"triggerCloudSave\" );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Password updated succesfully!</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tgetLogs: function( callback ) {\n\t\t\t\tif ( !$rootScope.activeController || !$rootScope.activeController.ip ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + $rootScope.activeController.ip + \"/jl\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data.logs.sort( function( a, b ) { return b[ 0 ] - a[ 0 ]; } ) );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t    };\n} ] );\n"],"sourceRoot":"/source/"}